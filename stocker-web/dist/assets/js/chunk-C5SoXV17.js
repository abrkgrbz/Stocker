var B=Object.defineProperty,G=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var I=(l,t,n)=>t in l?B(l,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[t]=n,z=(l,t)=>{for(var n in t||(t={}))K.call(t,n)&&I(l,n,t[n]);if($)for(var n of $(t))W.call(t,n)&&I(l,n,t[n]);return l},F=(l,t)=>G(l,H(t));var k=(l,t,n)=>I(l,typeof t!="symbol"?t+"":t,n);var a=(l,t,n)=>new Promise((i,e)=>{var o=d=>{try{r(n.next(d))}catch(f){e(f)}},c=d=>{try{r(n.throw(d))}catch(f){e(f)}},r=d=>d.done?i(d.value):Promise.resolve(d.value).then(o,c);r((n=n.apply(l,t)).next())});import{r as m}from"./chunk-a6Wk6XzP.js";import{A as Y}from"../index-BEW7Pg8Q.js";import{H as p,a as L,b as X,L as U}from"./chunk-yPPt1y7D.js";class Z{constructor(){k(this,"validationConnection",null);k(this,"notificationConnection",null);k(this,"baseUrl",Y)}startValidationConnection(){return a(this,null,function*(){var t;if(((t=this.validationConnection)==null?void 0:t.state)!==p.Connected){this.validationConnection=new L().withUrl(`${this.baseUrl}/hubs/validation`,{transport:X.LongPolling}).withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).configureLogging(U.Debug).build(),this.validationConnection.onreconnecting(()=>{}),this.validationConnection.onreconnected(()=>{}),this.validationConnection.onclose(()=>{});try{yield this.validationConnection.start()}catch(n){throw console.error("Error connecting to validation hub:",n),n}}})}startNotificationConnection(t){return a(this,null,function*(){var i;if(((i=this.notificationConnection)==null?void 0:i.state)===p.Connected)return;const n={withCredentials:!0};t&&(n.accessTokenFactory=()=>t),this.notificationConnection=new L().withUrl(`${this.baseUrl}/hubs/notification`,F(z({},n),{transport:X.LongPolling})).withAutomaticReconnect([0,2e3,5e3,1e4,3e4]).configureLogging(U.Debug).build(),this.notificationConnection.onreconnecting(()=>{}),this.notificationConnection.onreconnected(()=>{}),this.notificationConnection.onclose(()=>{});try{yield this.notificationConnection.start()}catch(e){throw console.error("Error connecting to notification hub:",e),e}})}validateEmail(t){return a(this,null,function*(){return(!this.validationConnection||this.validationConnection.state!==p.Connected)&&(yield this.startValidationConnection()),this.validationConnection.invoke("ValidateEmail",t)})}onEmailValidated(t){var n;(n=this.validationConnection)==null||n.on("EmailValidated",t)}checkPasswordStrength(t){return a(this,null,function*(){return(!this.validationConnection||this.validationConnection.state!==p.Connected)&&(yield this.startValidationConnection()),this.validationConnection.invoke("CheckPasswordStrength",t)})}onPasswordStrengthChecked(t){var n;(n=this.validationConnection)==null||n.on("PasswordStrengthChecked",t)}checkDomain(t){return a(this,null,function*(){return(!this.validationConnection||this.validationConnection.state!==p.Connected)&&(yield this.startValidationConnection()),this.validationConnection.invoke("CheckDomain",t)})}onDomainChecked(t){var n;(n=this.validationConnection)==null||n.on("DomainChecked",t)}validatePhone(t,n="TR"){return a(this,null,function*(){return(!this.validationConnection||this.validationConnection.state!==p.Connected)&&(yield this.startValidationConnection()),this.validationConnection.invoke("ValidatePhone",t,n)})}onPhoneValidated(t){var n;(n=this.validationConnection)==null||n.on("PhoneValidated",t)}checkCompanyName(t){return a(this,null,function*(){return(!this.validationConnection||this.validationConnection.state!==p.Connected)&&(yield this.startValidationConnection()),this.validationConnection.invoke("CheckCompanyName",t)})}onCompanyNameChecked(t){var n;(n=this.validationConnection)==null||n.on("CompanyNameChecked",t)}validateIdentity(t){return a(this,null,function*(){return(!this.validationConnection||this.validationConnection.state!==p.Connected)&&(yield this.startValidationConnection()),this.validationConnection.invoke("ValidateIdentity",t)})}onIdentityValidated(t){var n;(n=this.validationConnection)==null||n.on("IdentityValidated",t)}onNotificationReceived(t){var n;(n=this.notificationConnection)==null||n.on("ReceiveNotification",t)}onConnected(t){var n,i;(n=this.validationConnection)==null||n.on("Connected",t),(i=this.notificationConnection)==null||i.on("Connected",t)}onValidationError(t){var n;(n=this.validationConnection)==null||n.on("ValidationError",t)}stopValidationConnection(){return a(this,null,function*(){this.validationConnection&&(yield this.validationConnection.stop(),this.validationConnection=null)})}stopNotificationConnection(){return a(this,null,function*(){this.notificationConnection&&(yield this.notificationConnection.stop(),this.notificationConnection=null)})}stopAllConnections(){return a(this,null,function*(){yield this.stopValidationConnection(),yield this.stopNotificationConnection()})}}const P=new Z;class _{constructor(){k(this,"emailCallbacks",[]);k(this,"passwordCallbacks",[]);k(this,"domainCallbacks",[]);k(this,"phoneCallbacks",[]);k(this,"companyCallbacks",[]);k(this,"identityCallbacks",[]);k(this,"notificationCallbacks",[]);k(this,"connectedCallbacks",[]);k(this,"errorCallbacks",[])}startValidationConnection(){return a(this,null,function*(){yield new Promise(t=>setTimeout(t,500)),this.connectedCallbacks.forEach(t=>t({connectionId:"mock-connection-id"}))})}startNotificationConnection(t){return a(this,null,function*(){yield new Promise(n=>setTimeout(n,500)),this.connectedCallbacks.forEach(n=>n({connectionId:"mock-notification-id",token:t}))})}validateEmail(t){return a(this,null,function*(){setTimeout(()=>{const i=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),e={isValid:i,message:i?"Email adresi geçerli":"Geçersiz email formatı",details:{format:i?"valid":"invalid",domain:t.split("@")[1]||"",suggestion:!i&&!t.includes("@")?"@ işareti eksik":""}};this.emailCallbacks.forEach(o=>o(e))},300)})}onEmailValidated(t){this.emailCallbacks.push(t)}checkPasswordStrength(t){return a(this,null,function*(){setTimeout(()=>{let n=0;const i=[];t.length>=8?n++:i.push("En az 8 karakter kullanın"),t.length>=12&&n++,/[A-Z]/.test(t)?n++:i.push("Büyük harf ekleyin"),/[a-z]/.test(t)?n++:i.push("Küçük harf ekleyin"),/\d/.test(t)?n++:i.push("Rakam ekleyin"),/[!@#$%^&*(),.?":{}|<>]/.test(t)?n++:i.push("Özel karakter ekleyin (!@#$%^&*)");const e=["VeryWeak","Weak","Fair","Strong","VeryStrong"],o=["#ff4d4f","#faad14","#fadb14","#52c41a","#389e0d"],c=Math.min(Math.floor(n/1.5),4),r={score:Math.min(n,5),level:e[c],color:o[c],suggestions:i};this.passwordCallbacks.forEach(d=>d(r))},200)})}onPasswordStrengthChecked(t){this.passwordCallbacks.push(t)}checkDomain(t){return a(this,null,function*(){setTimeout(()=>{const i=!["test.stocker.app","demo.stocker.app","example.stocker.app"].includes(t.toLowerCase()),e=t.split(".")[0],o=i?[]:[`${e}1.stocker.app`,`${e}-company.stocker.app`,`${e}2024.stocker.app`],c={isAvailable:i,message:i?"Domain kullanılabilir":"Bu domain zaten kullanılıyor",suggestions:o};this.domainCallbacks.forEach(r=>r(c))},400)})}onDomainChecked(t){this.domainCallbacks.push(t)}validatePhone(t,n="TR"){return a(this,null,function*(){setTimeout(()=>{const i=t.replace(/\D/g,""),e=n==="TR"?/^(90)?5\d{9}$/.test(i)||/^5\d{9}$/.test(i):i.length>=10,o={isValid:e,message:e?"Telefon numarası geçerli":"Geçersiz telefon numarası formatı",details:{countryCode:n,format:e?"valid":"invalid",suggestion:n==="TR"&&!e?"Türkiye telefon numarası 5XX XXX XX XX formatında olmalı":""}};this.phoneCallbacks.forEach(c=>c(o))},300)})}onPhoneValidated(t){this.phoneCallbacks.push(t)}checkCompanyName(t){return a(this,null,function*(){setTimeout(()=>{const i=!["ABC Teknoloji","XYZ Yazılım","Test Company"].some(o=>o.toLowerCase()===t.toLowerCase()),e={isValid:i,message:i?"Şirket adı kullanılabilir":"Bu şirket adı zaten kayıtlı",details:{available:i?"yes":"no",suggestion:i?"":"Şirket adına bir numara veya ayırt edici kelime ekleyin"}};this.companyCallbacks.forEach(o=>o(e))},350)})}onCompanyNameChecked(t){this.companyCallbacks.push(t)}validateIdentity(t){return a(this,null,function*(){setTimeout(()=>{const n=t.replace(/\D/g,"");let i=!1,e="",o="";n.length===11?(e="TCKimlik",i=this.validateTCKimlikNo(n),o=i?"TC Kimlik numarası geçerli":"Geçersiz TC Kimlik numarası"):n.length===10?(e="VergiNo",i=this.validateVergiNo(n),o=i?"Vergi numarası geçerli":"Geçersiz Vergi numarası"):o="Kimlik/Vergi numarası 10 veya 11 haneli olmalıdır";const c={isValid:i,message:o,details:{numberType:e,formattedNumber:n,length:n.length.toString()}};this.identityCallbacks.forEach(r=>r(c))},400)})}validateTCKimlikNo(t){if(t.length!==11||!/^\d{11}$/.test(t)||t[0]==="0")return!1;const n=t.split("").map(Number),i=n[0]+n[2]+n[4]+n[6]+n[8],e=n[1]+n[3]+n[5]+n[7];let o=(i*7-e)%10;if(o<0&&(o+=10),n[9]!==o)return!1;const r=n.slice(0,10).reduce((d,f)=>d+f,0)%10;return n[10]===r}validateVergiNo(t){if(t.length!==10||!/^\d{10}$/.test(t))return!1;const n=t.split("").map(Number);let i=(n[0]+9)%10,e=i*2%9;i!==0&&e===0&&(e=9);let o=(n[1]+8)%10,c=o*4%9;o!==0&&c===0&&(c=9);let r=(n[2]+7)%10,d=r*8%9;r!==0&&d===0&&(d=9);let f=(n[3]+6)%10,y=f*16%9;f!==0&&y===0&&(y=9);let b=(n[4]+5)%10,V=b*32%9;b!==0&&V===0&&(V=9);let w=(n[5]+4)%10,S=w*64%9;w!==0&&S===0&&(S=9);let s=(n[6]+3)%10,g=s*128%9;s!==0&&g===0&&(g=9);let N=(n[7]+2)%10,h=N*256%9;N!==0&&h===0&&(h=9);let T=(n[8]+1)%10,E=T*512%9;T!==0&&E===0&&(E=9);const D=(10-(e+c+d+y+V+S+g+h+E)%10)%10;return n[9]===D}onIdentityValidated(t){this.identityCallbacks.push(t)}onNotificationReceived(t){this.notificationCallbacks.push(t),setTimeout(()=>{t({id:"mock-1",title:"Hoş Geldiniz",message:"SignalR Mock Service aktif",type:"Info",priority:"Normal",createdAt:new Date,icon:"info"})},2e3)}onConnected(t){this.connectedCallbacks.push(t)}onValidationError(t){this.errorCallbacks.push(t)}stopValidationConnection(){return a(this,null,function*(){this.emailCallbacks=[],this.passwordCallbacks=[],this.domainCallbacks=[],this.phoneCallbacks=[],this.companyCallbacks=[],this.identityCallbacks=[],this.connectedCallbacks=[],this.errorCallbacks=[]})}stopNotificationConnection(){return a(this,null,function*(){this.notificationCallbacks=[]})}stopAllConnections(){return a(this,null,function*(){yield this.stopValidationConnection(),yield this.stopNotificationConnection()})}}const R=new _,Q=()=>{const[l,t]=m.useState(!1),[n,i]=m.useState(null),[e,o]=m.useState(null),[c,r]=m.useState(null),[d,f]=m.useState(null),[y,b]=m.useState(null),[V,w]=m.useState(null),[S,s]=m.useState(null),[g,N]=m.useState(!1);m.useEffect(()=>(a(null,null,function*(){const u=g?R:P;try{g?(yield R.startValidationConnection(),console.log("🔧 Using mock SignalR validation service")):(yield P.startValidationConnection(),console.log("✅ Connected to real SignalR validation service at","http://localhost:5104")),t(!0),u.onEmailValidated(C=>{i(C)}),u.onPasswordStrengthChecked(C=>{o(C)}),u.onDomainChecked(C=>{r(C)}),u.onPhoneValidated(C=>{f(C)}),u.onCompanyNameChecked(C=>{b(C)}),u.onIdentityValidated(C=>{w(C)}),u.onValidationError(C=>{s(C)}),u.onConnected(()=>{})}catch(C){console.error("Failed to connect to SignalR, falling back to mock service:",C),g?(s("Failed to connect to validation service"),t(!1)):(console.warn("⚠️ Falling back to mock validation service - API not available at","http://localhost:5104"),N(!0),s("Using mock validation service (API not available)"))}}),()=>{g?R.stopValidationConnection():P.stopValidationConnection()}),[g]);const h=g?R:P,T=m.useCallback(v=>a(null,null,function*(){s(null),i(null);try{yield h.validateEmail(v)}catch(u){s("Failed to validate email")}}),[h]),E=m.useCallback(v=>a(null,null,function*(){s(null),o(null);try{yield h.checkPasswordStrength(v)}catch(u){s("Failed to check password strength")}}),[h]),A=m.useCallback(v=>a(null,null,function*(){s(null),r(null);try{yield h.checkDomain(v)}catch(u){s("Failed to check domain")}}),[h]),D=m.useCallback((v,u="TR")=>a(null,null,function*(){s(null),f(null);try{yield h.validatePhone(v,u)}catch(C){s("Failed to validate phone")}}),[h]),M=m.useCallback(v=>a(null,null,function*(){s(null),b(null);try{yield h.checkCompanyName(v)}catch(u){s("Failed to check company name")}}),[h]),x=m.useCallback(v=>a(null,null,function*(){s(null),w(null);try{yield h.validateIdentity(v)}catch(u){s("Failed to validate identity number")}}),[h]);return{isConnected:l,emailValidation:n,passwordStrength:e,domainCheck:c,phoneValidation:d,companyNameCheck:y,identityValidation:V,error:S,validateEmail:T,checkPasswordStrength:E,checkDomain:A,validatePhone:D,checkCompanyName:M,validateIdentity:x}};export{Q as u};
