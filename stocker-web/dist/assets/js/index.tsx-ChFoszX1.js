var se=Object.defineProperty,ne=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var O=(c,n,r)=>n in c?se(c,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):c[n]=r,Y=(c,n)=>{for(var r in n||(n={}))le.call(n,r)&&O(c,r,n[r]);if($)for(var r of $(n))ce.call(n,r)&&O(c,r,n[r]);return c},M=(c,n)=>ne(c,re(n));var H=(c,n,r)=>new Promise((D,m)=>{var v=o=>{try{k(r.next(o))}catch(f){m(f)}},h=o=>{try{k(r.throw(o))}catch(f){m(f)}},k=o=>o.done?D(o.value):Promise.resolve(o.value).then(v,h);k((r=r.apply(c,n)).next())});import{ag as d,j as e,y as V,M as b,N as u,O as C,ah as E,p as _,bf as K,Y as g,a_ as P,S as j,A as oe,e as L,F as de,an as ue,v as w,aY as U,aW as me,a1 as xe,bn as he,aT as G,aO as je,s as pe,am as S,bg as q,b6 as ye}from"./chunk-CQugYT0Y.js";import{u as ge,r as T}from"./chunk-a6Wk6XzP.js";import{i as p}from"./chunk-8twwa0Xh.js";import"./chunk-B1KqMBAo.js";import"./chunk-CX9aqCgN.js";const{TextArea:W}=E,{Option:x}=P,{Title:A,Text:l}=de,X=[{id:"1",name:"ABC Teknoloji A.Ş.",email:"info@abc.com",phone:"0212 555 0001",taxNumber:"1234567890"},{id:"2",name:"XYZ Yazılım Ltd.",email:"contact@xyz.com",phone:"0216 555 0002",taxNumber:"0987654321"},{id:"3",name:"Demo Şirketi",email:"demo@demo.com",phone:"0312 555 0003",taxNumber:"1122334455"}],ve=[{id:"1",name:"Yazılım Lisansı",price:5e3,description:"Yıllık yazılım lisansı"},{id:"2",name:"Danışmanlık Hizmeti",price:1500,description:"Saatlik danışmanlık ücreti"},{id:"3",name:"Eğitim Paketi",price:1e4,description:"3 günlük eğitim paketi"},{id:"4",name:"Destek Hizmeti",price:2e3,description:"Aylık teknik destek"}],De=()=>{const[c]=d.useForm(),n=ge(),[r,D]=T.useState(!1),[m,v]=T.useState([]),[h,k]=T.useState(null),[o,f]=T.useState({subTotal:0,taxAmount:0,discountAmount:0,totalAmount:0}),[Z,N]=T.useState(!1),R=t=>{let i=0,a=0,s=0;t.forEach(y=>{const F=y.quantity*y.unitPrice,B=F*((y.discountPercentage||0)/100),ae=(F-B)*((y.taxRate||0)/100);i+=F,s+=B,a+=ae});const z=i-s+a;f({subTotal:i,taxAmount:a,discountAmount:s,totalAmount:z})},J=()=>{N(!0)},Q=t=>{const i={productId:t.id,productName:t.name,description:t.description,quantity:1,unitPrice:t.price,discountPercentage:0,taxRate:18},a=[...m,i];v(a),R(a),N(!1)},I=(t,i,a)=>{const s=[...m];s[t]=M(Y({},s[t]),{[i]:a}),v(s),R(s)},ee=t=>{const i=m.filter((a,s)=>s!==t);v(i),R(i)},te=t=>H(null,null,function*(){if(m.length===0){S.warning("En az bir ürün/hizmet eklemelisiniz");return}try{D(!0);const i=M(Y({},t),{invoiceDate:t.invoiceDate.toISOString(),dueDate:t.dueDate.toISOString(),items:m}),a=yield p.createInvoice(i);S.success("Fatura başarıyla oluşturuldu"),t.sendImmediately&&(yield p.sendInvoice(a.id),S.success("Fatura müşteriye gönderildi")),n("/invoices")}catch(i){S.error("Fatura oluşturulurken hata oluştu")}finally{D(!1)}}),ie=[{title:"Ürün/Hizmet",dataIndex:"productName",key:"productName",width:"25%"},{title:"Açıklama",dataIndex:"description",key:"description",width:"20%",render:(t,i,a)=>e.jsx(E,{value:i.description,onChange:s=>I(a,"description",s.target.value),placeholder:"Açıklama..."})},{title:"Miktar",dataIndex:"quantity",key:"quantity",width:"10%",render:(t,i,a)=>e.jsx(q,{min:.01,value:i.quantity,onChange:s=>I(a,"quantity",s)})},{title:"Birim Fiyat",dataIndex:"unitPrice",key:"unitPrice",width:"12%",render:(t,i,a)=>e.jsx(q,{min:0,value:i.unitPrice,onChange:s=>I(a,"unitPrice",s),formatter:s=>`₺ ${s}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")})},{title:"İndirim %",dataIndex:"discountPercentage",key:"discountPercentage",width:"10%",render:(t,i,a)=>e.jsx(q,{min:0,max:100,value:i.discountPercentage,onChange:s=>I(a,"discountPercentage",s),formatter:s=>`${s}%`})},{title:"KDV %",dataIndex:"taxRate",key:"taxRate",width:"10%",render:(t,i,a)=>e.jsxs(P,{value:i.taxRate,onChange:s=>I(a,"taxRate",s),style:{width:"100%"},children:[e.jsx(x,{value:0,children:"%0"}),e.jsx(x,{value:1,children:"%1"}),e.jsx(x,{value:8,children:"%8"}),e.jsx(x,{value:18,children:"%18"})]})},{title:"Toplam",key:"total",width:"10%",align:"right",render:(t,i)=>{const a=i.quantity*i.unitPrice,s=a*((i.discountPercentage||0)/100),z=a-s,y=z*((i.taxRate||0)/100);return e.jsxs(l,{strong:!0,children:["₺",(z+y).toFixed(2)]})}},{title:"",key:"action",width:"3%",render:(t,i,a)=>e.jsx(w,{type:"text",danger:!0,icon:e.jsx(ye,{}),onClick:()=>ee(a)})}];return e.jsxs("div",{className:"create-invoice",children:[e.jsx(d,{form:c,layout:"vertical",onFinish:te,initialValues:{currency:"TRY",invoiceDate:V(),dueDate:V().add(30,"days"),invoiceNumber:`INV-${new Date().getFullYear()}-${String(Math.floor(Math.random()*1e4)).padStart(4,"0")}`},children:e.jsxs(b,{gutter:24,children:[e.jsx(u,{xs:24,lg:16,children:e.jsxs(C,{title:e.jsxs(j,{children:[e.jsx(_,{}),e.jsx("span",{children:"Yeni Fatura Oluştur"})]}),className:"invoice-form-card",children:[e.jsxs(b,{gutter:16,children:[e.jsx(u,{xs:24,md:8,children:e.jsx(d.Item,{name:"invoiceNumber",label:"Fatura No",rules:[{required:!0,message:"Fatura no zorunludur"}],children:e.jsx(E,{prefix:e.jsx(_,{})})})}),e.jsx(u,{xs:24,md:8,children:e.jsx(d.Item,{name:"invoiceDate",label:"Fatura Tarihi",rules:[{required:!0,message:"Fatura tarihi zorunludur"}],children:e.jsx(K,{style:{width:"100%"},format:"DD/MM/YYYY"})})}),e.jsx(u,{xs:24,md:8,children:e.jsx(d.Item,{name:"dueDate",label:"Vade Tarihi",rules:[{required:!0,message:"Vade tarihi zorunludur"}],children:e.jsx(K,{style:{width:"100%"},format:"DD/MM/YYYY"})})})]}),e.jsx(g,{children:"Müşteri Bilgileri"}),e.jsx(b,{gutter:16,children:e.jsx(u,{xs:24,children:e.jsx(d.Item,{name:"customerId",label:"Müşteri",rules:[{required:!0,message:"Müşteri seçimi zorunludur"}],children:e.jsx(P,{showSearch:!0,placeholder:"Müşteri seçin veya arayın",optionFilterProp:"children",onChange:t=>{const i=X.find(a=>a.id===t);k(i)},children:X.map(t=>e.jsx(x,{value:t.id,children:e.jsxs(j,{children:[e.jsx(oe,{icon:e.jsx(L,{}),size:"small"}),e.jsxs("div",{children:[e.jsx("div",{children:t.name}),e.jsxs(l,{type:"secondary",style:{fontSize:12},children:[t.email," | ",t.phone]})]})]})},t.id))})})})}),h&&e.jsx(ue,{message:"Seçili Müşteri",description:e.jsxs(j,{direction:"vertical",size:"small",children:[e.jsx(l,{children:h.name}),e.jsxs(l,{type:"secondary",children:[h.email," | ",h.phone]}),e.jsxs(l,{type:"secondary",children:["Vergi No: ",h.taxNumber]})]}),type:"info",showIcon:!0,icon:e.jsx(L,{}),style:{marginBottom:16}}),e.jsx(g,{children:"Ürün/Hizmetler"}),e.jsx(w,{type:"dashed",onClick:J,icon:e.jsx(U,{}),style:{width:"100%",marginBottom:16},children:"Ürün/Hizmet Ekle"}),e.jsx(me,{dataSource:m,columns:ie,pagination:!1,rowKey:(t,i)=>(i==null?void 0:i.toString())||"0",locale:{emptyText:"Henüz ürün/hizmet eklenmedi"}}),e.jsx(g,{children:"Ek Bilgiler"}),e.jsxs(b,{gutter:16,children:[e.jsx(u,{xs:24,md:12,children:e.jsx(d.Item,{name:"notes",label:"Notlar",children:e.jsx(W,{rows:4,placeholder:"Fatura ile ilgili notlar..."})})}),e.jsx(u,{xs:24,md:12,children:e.jsx(d.Item,{name:"terms",label:"Şartlar ve Koşullar",children:e.jsx(W,{rows:4,placeholder:"Ödeme şartları, teslimat koşulları vb..."})})})]})]})}),e.jsxs(u,{xs:24,lg:8,children:[e.jsxs(C,{className:"invoice-summary-card",children:[e.jsxs(A,{level:4,children:[e.jsx(xe,{})," Fatura Özeti"]}),e.jsxs("div",{className:"summary-items",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx(l,{children:"Ara Toplam:"}),e.jsx(l,{strong:!0,children:p.formatCurrency(o.subTotal)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx(l,{children:"İndirim:"}),e.jsxs(l,{type:"danger",children:["-",p.formatCurrency(o.discountAmount)]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx(l,{children:"KDV:"}),e.jsx(l,{children:p.formatCurrency(o.taxAmount)})]}),e.jsx(g,{}),e.jsxs("div",{className:"summary-item total",children:[e.jsx(A,{level:5,children:"Genel Toplam:"}),e.jsx(A,{level:4,type:"success",children:p.formatCurrency(o.totalAmount)})]})]}),e.jsx(g,{}),e.jsx(d.Item,{name:"currency",label:"Para Birimi",children:e.jsxs(P,{children:[e.jsx(x,{value:"TRY",children:"TRY - Türk Lirası"}),e.jsx(x,{value:"USD",children:"USD - Amerikan Doları"}),e.jsx(x,{value:"EUR",children:"EUR - Euro"})]})}),e.jsx(d.Item,{name:"sendImmediately",valuePropName:"checked",children:e.jsxs(j,{children:[e.jsx("input",{type:"checkbox"}),e.jsx(l,{children:"Oluşturduktan sonra hemen gönder"})]})}),e.jsxs(j,{direction:"vertical",style:{width:"100%"},children:[e.jsx(w,{type:"primary",htmlType:"submit",loading:r,icon:e.jsx(he,{}),size:"large",block:!0,children:"Faturayı Oluştur"}),e.jsx(w,{onClick:()=>n("/invoices"),size:"large",block:!0,children:"İptal"})]})]}),e.jsxs(C,{style:{marginTop:16},children:[e.jsx(A,{level:5,children:"Bu Ay"}),e.jsxs(b,{gutter:16,children:[e.jsx(u,{span:12,children:e.jsx(G,{title:"Kesilen Fatura",value:23,prefix:e.jsx(_,{})})}),e.jsx(u,{span:12,children:e.jsx(G,{title:"Toplam Tutar",value:125430,prefix:"₺"})})]})]})]})]})}),e.jsxs(je,{title:"Ürün/Hizmet Seç",visible:Z,onCancel:()=>N(!1),footer:null,width:600,children:[e.jsx("div",{className:"product-grid",children:ve.map(t=>e.jsx(C,{hoverable:!0,onClick:()=>Q(t),className:"product-card",children:e.jsxs(j,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(j,{children:[e.jsx(pe,{}),e.jsx(l,{strong:!0,children:t.name})]}),e.jsx(l,{type:"secondary",children:t.description}),e.jsx(l,{type:"success",strong:!0,children:p.formatCurrency(t.price)})]})},t.id))}),e.jsx(g,{}),e.jsx(w,{type:"dashed",icon:e.jsx(U,{}),block:!0,onClick:()=>{S.info("Yeni ürün ekleme özelliği yakında"),N(!1)},children:"Yeni Ürün Ekle"})]})]})};export{De as default};
