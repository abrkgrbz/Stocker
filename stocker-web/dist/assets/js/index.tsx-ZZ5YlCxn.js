var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(a,t,i)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i,l=(e,a)=>{for(var t in a||(a={}))s.call(a,t)&&n(e,t,a[t]);if(i)for(var t of i(a))r.call(a,t)&&n(e,t,a[t]);return e},d=(e,i)=>a(e,t(i)),c=(e,a,t)=>new Promise((i,s)=>{var r=e=>{try{l(t.next(e))}catch(a){s(a)}},n=e=>{try{l(t.throw(e))}catch(a){s(a)}},l=e=>e.done?i(e.value):Promise.resolve(e.value).then(r,n);l((t=t.apply(e,a)).next())});import{ag as o,y as u,am as m,j as x,t as h,bi as j,v as p,bm as y,M as v,N as f,O as k,F as g,aw as b,ah as T,e as N,aj as D,ay as A,ai as P,Y as I,b9 as z,aT as R,aR as w,ba as Y,bn as M,S as C,an as F,a1 as O,aJ as q}from"./chunk-BKiBcwD8.js";import{j as S,u as E,r as B}from"./chunk-nBmrMGrr.js";import{a as V}from"./chunk-BjeZWTP8.js";import"../index-DvFJre66.js";import"./chunk-BsETiAjl.js";const{Title:X,Text:K}=g,{Option:H}=b,{TextArea:L}=T,G=()=>{const{id:e}=S(),a=E(),[t]=o.useForm(),[i,s]=B.useState(!1),[r,n]=B.useState(!1),[g,G]=B.useState([]),[$,J]=B.useState([]),[U,Z]=B.useState([]),[Q,W]=B.useState({subTotal:0,taxAmount:0,discountAmount:0,totalAmount:0});B.useEffect(()=>{if(e)_();else{const e=[{id:"1",productId:"",productName:"",description:"",quantity:1,unitPrice:0,taxRate:18,discountRate:0,totalPrice:0}];Z(e),t.setFieldsValue({invoiceDate:u(),dueDate:u().add(30,"days"),paymentMethod:"BankTransfer",items:e})}ee(),ae()},[e]),B.useEffect(()=>{ie()},[U]);const _=()=>c(null,null,function*(){try{s(!0);const a={id:e,invoiceNumber:"INV-2024-001",customerId:"1",customerName:"ABC Teknoloji A.Ş.",customerEmail:"muhasebe@abcteknoloji.com",customerPhone:"+90 212 555 0100",customerAddress:"Maslak Mah. Teknoloji Cad. No:15\nSarıyer/İstanbul",customerTaxNumber:"1234567890",customerTaxOffice:"Sarıyer",invoiceDate:"2024-01-15T00:00:00",dueDate:"2024-02-15T00:00:00",subTotal:1e4,taxAmount:1800,discountAmount:500,totalAmount:11300,currency:"TRY",status:"Draft",paymentMethod:"BankTransfer",notes:"Ödeme IBAN: TR12 0001 2345 6789 0123 4567 89",items:[{id:"1",productId:"1",productName:"Yazılım Lisansı - Pro",description:"Yıllık yazılım lisansı",quantity:2,unitPrice:3e3,taxRate:18,discountRate:5,totalPrice:5700},{id:"2",productId:"2",productName:"Destek Paketi",description:"7/24 teknik destek hizmeti",quantity:1,unitPrice:4e3,taxRate:18,discountRate:0,totalPrice:4720}],createdAt:"2024-01-15T10:30:00"};t.setFieldsValue(d(l({},a),{invoiceDate:u(a.invoiceDate),dueDate:u(a.dueDate)})),Z(a.items)}catch(a){m.error("Fatura yüklenemedi")}finally{s(!1)}}),ee=()=>c(null,null,function*(){G([{id:"1",name:"ABC Teknoloji A.Ş.",email:"muhasebe@abcteknoloji.com",phone:"+90 212 555 0100",address:"Maslak Mah. Teknoloji Cad. No:15\nSarıyer/İstanbul",taxNumber:"1234567890",taxOffice:"Sarıyer"},{id:"2",name:"XYZ Yazılım Ltd.",email:"info@xyzyazilim.com",phone:"+90 216 555 0200",address:"Ataşehir/İstanbul",taxNumber:"9876543210",taxOffice:"Ataşehir"}])}),ae=()=>c(null,null,function*(){J([{id:"1",name:"Yazılım Lisansı - Pro",description:"Yıllık yazılım lisansı",price:3e3,taxRate:18},{id:"2",name:"Destek Paketi",description:"7/24 teknik destek hizmeti",price:4e3,taxRate:18},{id:"3",name:"Eğitim Hizmeti",description:"Uzaktan eğitim (10 saat)",price:5e3,taxRate:18}])}),te=(e,a)=>{const t=(a.quantity||0)*(a.unitPrice||0),i=t-t*((a.discountRate||0)/100),s=i+i*((a.taxRate||0)/100),r=[...U];r[e]=d(l(l({},r[e]),a),{totalPrice:s}),Z(r)},ie=()=>{let e=0,a=0,t=0;U.forEach(i=>{const s=(i.quantity||0)*(i.unitPrice||0),r=s*((i.discountRate||0)/100),n=(s-r)*((i.taxRate||0)/100);e+=s,t+=r,a+=n});W({subTotal:e,taxAmount:a,discountAmount:t,totalAmount:e-t+a})},se=(e,a,t)=>{const i=[...U];i[e]=d(l({},i[e]),{[a]:t}),["quantity","unitPrice","discountRate","taxRate"].includes(a)?te(e,i[e]):Z(i)},re=t=>c(null,null,function*(){try{n(!0);d(l(d(l({},t),{items:U}),Q),{invoiceDate:t.invoiceDate.format("YYYY-MM-DD"),dueDate:t.dueDate.format("YYYY-MM-DD")});e?m.success("Fatura güncellendi"):m.success("Fatura oluşturuldu"),a(-1)}catch(i){m.error("İşlem başarısız")}finally{n(!1)}});return i?x.jsx("div",{style:{textAlign:"center",padding:100},children:x.jsx(h,{size:"large"})}):x.jsxs("div",{className:"invoice-edit-page",children:[x.jsx(j,{ghost:!1,onBack:()=>a(-1),title:e?"Fatura Düzenle":"Yeni Fatura",extra:[x.jsx(p,{onClick:()=>{q.confirm({title:"İptal Et",content:"Değişiklikler kaybolacak. Devam etmek istiyor musunuz?",okText:"Evet",cancelText:"Hayır",onOk:()=>a(-1)})},children:"İptal"},"cancel"),x.jsx(p,{onClick:()=>t.submit(),loading:r,children:"Taslak Kaydet"},"save-draft"),x.jsx(p,{type:"primary",icon:x.jsx(y,{}),onClick:()=>{t.validateFields().then(e=>{(e=>{c(null,null,function*(){yield re(e),m.info("Fatura kaydedildi ve gönderildi")})})(e)})},loading:r,children:"Kaydet ve Gönder"},"save-send")]}),x.jsx("div",{className:"invoice-edit-content",children:x.jsx(o,{form:t,layout:"vertical",onFinish:re,className:"invoice-form",children:x.jsxs(v,{gutter:24,children:[x.jsx(f,{xs:24,lg:16,children:x.jsxs(k,{title:"Fatura Bilgileri",className:"invoice-card",children:[x.jsx(X,{level:5,children:"Müşteri Bilgileri"}),x.jsxs(v,{gutter:16,children:[x.jsx(f,{span:12,children:x.jsx(o.Item,{name:"customerId",label:"Müşteri Seç",children:x.jsx(b,{showSearch:!0,placeholder:"Müşteri seçin veya yeni ekleyin",onChange:e=>{const a=g.find(a=>a.id===e);a&&t.setFieldsValue({customerName:a.name,customerEmail:a.email,customerPhone:a.phone,customerAddress:a.address,customerTaxNumber:a.taxNumber,customerTaxOffice:a.taxOffice})},filterOption:(e,a)=>(null==a?void 0:a.children).toLowerCase().includes(e.toLowerCase()),children:g.map(e=>x.jsx(H,{value:e.id,children:e.name},e.id))})})}),x.jsx(f,{span:12,children:x.jsx(o.Item,{name:"customerName",label:"Müşteri Adı",rules:[{required:!0,message:"Müşteri adı zorunludur"}],children:x.jsx(T,{prefix:x.jsx(N,{}),placeholder:"Müşteri adı"})})})]}),x.jsxs(v,{gutter:16,children:[x.jsx(f,{span:12,children:x.jsx(o.Item,{name:"customerEmail",label:"Email",rules:[{required:!0,message:"Email zorunludur"},{type:"email",message:"Geçerli email giriniz"}],children:x.jsx(T,{prefix:x.jsx(D,{}),placeholder:"email@example.com"})})}),x.jsx(f,{span:12,children:x.jsx(o.Item,{name:"customerPhone",label:"Telefon",rules:[{required:!0,message:"Telefon zorunludur"}],children:x.jsx(T,{prefix:x.jsx(A,{}),placeholder:"+90 5XX XXX XXXX"})})})]}),x.jsx(v,{gutter:16,children:x.jsx(f,{span:24,children:x.jsx(o.Item,{name:"customerAddress",label:"Adres",rules:[{required:!0,message:"Adres zorunludur"}],children:x.jsx(L,{rows:2,placeholder:"Müşteri adresi",prefix:x.jsx(P,{})})})})}),x.jsxs(v,{gutter:16,children:[x.jsx(f,{span:12,children:x.jsx(o.Item,{name:"customerTaxNumber",label:"Vergi No",children:x.jsx(T,{placeholder:"Vergi numarası"})})}),x.jsx(f,{span:12,children:x.jsx(o.Item,{name:"customerTaxOffice",label:"Vergi Dairesi",children:x.jsx(T,{placeholder:"Vergi dairesi"})})})]}),x.jsx(I,{}),x.jsx(X,{level:5,children:"Fatura Detayları"}),x.jsxs(v,{gutter:16,children:[x.jsx(f,{span:8,children:x.jsx(o.Item,{name:"invoiceDate",label:"Fatura Tarihi",rules:[{required:!0,message:"Fatura tarihi zorunludur"}],children:x.jsx(z,{style:{width:"100%"},format:"DD.MM.YYYY"})})}),x.jsx(f,{span:8,children:x.jsx(o.Item,{name:"dueDate",label:"Vade Tarihi",rules:[{required:!0,message:"Vade tarihi zorunludur"}],children:x.jsx(z,{style:{width:"100%"},format:"DD.MM.YYYY"})})}),x.jsx(f,{span:8,children:x.jsx(o.Item,{name:"paymentMethod",label:"Ödeme Yöntemi",rules:[{required:!0,message:"Ödeme yöntemi zorunludur"}],children:x.jsxs(b,{children:[x.jsx(H,{value:"BankTransfer",children:"Banka Havalesi"}),x.jsx(H,{value:"CreditCard",children:"Kredi Kartı"}),x.jsx(H,{value:"Cash",children:"Nakit"}),x.jsx(H,{value:"Check",children:"Çek"})]})})})]}),x.jsx(I,{}),x.jsxs("div",{className:"invoice-items-section",children:[x.jsxs("div",{className:"section-header",children:[x.jsx(X,{level:5,children:"Ürün/Hizmet Kalemleri"}),x.jsx(p,{type:"dashed",onClick:()=>{const e={id:Date.now().toString(),productId:"",productName:"",description:"",quantity:1,unitPrice:0,taxRate:18,discountRate:0,totalPrice:0};Z([...U,e])},icon:x.jsx(R,{}),children:"Kalem Ekle"})]}),x.jsx(w,{dataSource:U,pagination:!1,rowKey:"id",className:"invoice-items-table",columns:[{title:"Ürün/Hizmet",dataIndex:"productName",width:250,render:(e,a,t)=>x.jsxs("div",{children:[x.jsx(b,{style:{width:"100%",marginBottom:8},placeholder:"Ürün seçin",value:a.productId,onChange:e=>((e,a)=>{const t=$.find(a=>a.id===e);if(t){const e=[...U];e[a]=d(l({},e[a]),{productId:t.id,productName:t.name,description:t.description,unitPrice:t.price,taxRate:t.taxRate}),Z(e),te(a,e[a])}})(e,t),showSearch:!0,children:$.map(e=>x.jsx(H,{value:e.id,children:e.name},e.id))}),x.jsx(T,{placeholder:"Açıklama",value:a.description,onChange:e=>se(t,"description",e.target.value)})]})},{title:"Miktar",dataIndex:"quantity",width:100,render:(e,a,t)=>x.jsx(Y,{min:1,value:a.quantity,onChange:e=>se(t,"quantity",e)})},{title:"Birim Fiyat",dataIndex:"unitPrice",width:120,render:(e,a,t)=>x.jsx(Y,{min:0,value:a.unitPrice,onChange:e=>se(t,"unitPrice",e),formatter:e=>`₺ ${e}`,parser:e=>e.replace("₺ ","")})},{title:"İndirim %",dataIndex:"discountRate",width:100,render:(e,a,t)=>x.jsx(Y,{min:0,max:100,value:a.discountRate,onChange:e=>se(t,"discountRate",e),formatter:e=>`${e}%`,parser:e=>e.replace("%","")})},{title:"KDV %",dataIndex:"taxRate",width:100,render:(e,a,t)=>x.jsxs(b,{value:a.taxRate,onChange:e=>se(t,"taxRate",e),children:[x.jsx(H,{value:0,children:"%0"}),x.jsx(H,{value:1,children:"%1"}),x.jsx(H,{value:8,children:"%8"}),x.jsx(H,{value:18,children:"%18"})]})},{title:"Toplam",dataIndex:"totalPrice",width:120,render:e=>x.jsx(K,{strong:!0,children:V(e||0)})},{title:"",width:50,render:(e,a,t)=>x.jsx(p,{type:"text",danger:!0,icon:x.jsx(M,{}),onClick:()=>(e=>{const a=U.filter((a,t)=>t!==e);Z(a)})(t),disabled:1===U.length})}]})]}),x.jsx(I,{}),x.jsx(X,{level:5,children:"Notlar"}),x.jsx(o.Item,{name:"notes",children:x.jsx(L,{rows:3,placeholder:"Fatura ile ilgili notlar (isteğe bağlı)"})})]})}),x.jsxs(f,{xs:24,lg:8,children:[x.jsx(k,{title:"Fatura Özeti",className:"summary-card",children:x.jsxs("div",{className:"summary-content",children:[x.jsxs("div",{className:"summary-item",children:[x.jsx(K,{children:"Ara Toplam:"}),x.jsx(K,{strong:!0,children:V(Q.subTotal)})]}),Q.discountAmount>0&&x.jsxs("div",{className:"summary-item",children:[x.jsx(K,{children:"İndirim:"}),x.jsxs(K,{type:"danger",children:["-",V(Q.discountAmount)]})]}),x.jsxs("div",{className:"summary-item",children:[x.jsx(K,{children:"KDV:"}),x.jsx(K,{children:V(Q.taxAmount)})]}),x.jsx(I,{}),x.jsxs("div",{className:"summary-item total",children:[x.jsx(X,{level:4,children:"Genel Toplam:"}),x.jsx(X,{level:4,style:{color:"#1890ff",margin:0},children:V(Q.totalAmount)})]})]})}),x.jsx(k,{title:"Hızlı İşlemler",style:{marginTop:16},children:x.jsxs(C,{direction:"vertical",style:{width:"100%"},children:[x.jsx(F,{message:"Fatura Durumu",description:e?"Taslak olarak kaydedilmiş":"Henüz kaydedilmemiş",type:"info",showIcon:!0}),x.jsx(p,{block:!0,icon:x.jsx(O,{}),onClick:ie,children:"Toplamları Yeniden Hesapla"})]})})]})]})})})]})};export{G as InvoiceEdit,G as default};
