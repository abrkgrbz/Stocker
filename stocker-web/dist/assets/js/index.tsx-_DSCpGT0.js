var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,l=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&n(e,a,t[a]);if(r)for(var a of r(t))i.call(t,a)&&n(e,a,t[a]);return e},o=(e,r)=>t(e,a(r)),c=(e,t,a)=>new Promise((r,s)=>{var i=e=>{try{l(a.next(e))}catch(t){s(t)}},n=e=>{try{l(a.throw(e))}catch(t){s(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,n);l((a=a.apply(e,t)).next())});import{au as d,j as u,L as x,M as m,O as h,bb as j,p,I as v,ac as f,b8 as g,ap as y,bl as b,b1 as k,aZ as T,b3 as D,bn as A,S,v as w,ar as I,bx as N,bf as C,bj as O,b4 as P,bd as F,b5 as z,B as Y,A as G,aM as R,T as M,D as B,br as V,by as L,bg as $,bi as Z}from"./chunk-Bf7f0GK8.js";import{u as E,r as J}from"./chunk-nBmrMGrr.js";import{i as K}from"./chunk-DjIl2cy0.js";import"./chunk-D55l7_Um.js";import"./chunk-BsETiAjl.js";const{RangePicker:X}=T,{Option:Q}=k,W=()=>{const e=E(),[t,a]=J.useState([]),[r,s]=J.useState(!1),[i,n]=J.useState({pageNumber:1,pageSize:20}),[T,W]=J.useState([]),[q,H]=J.useState({total:0,paid:0,pending:0,overdue:0});J.useEffect(()=>{U()},[i]);const U=()=>c(null,null,function*(){try{s(!0);let e=[...[{id:"1",invoiceNumber:"INV-2024-001",customerId:"1",customerName:"ABC Teknoloji A.Ş.",invoiceDate:"2024-01-15T00:00:00",dueDate:"2024-02-15T00:00:00",subTotal:1e4,taxAmount:1800,discountAmount:500,totalAmount:11300,currency:"TRY",status:"Paid",paidDate:"2024-02-10T00:00:00",paymentMethod:"BankTransfer",items:[],createdAt:"2024-01-15T00:00:00"},{id:"2",invoiceNumber:"INV-2024-002",customerId:"2",customerName:"XYZ Yazılım Ltd.",invoiceDate:"2024-01-20T00:00:00",dueDate:"2024-02-20T00:00:00",subTotal:25e3,taxAmount:4500,discountAmount:1e3,totalAmount:28500,currency:"TRY",status:"Overdue",items:[],createdAt:"2024-01-20T00:00:00"},{id:"3",invoiceNumber:"INV-2024-003",customerId:"3",customerName:"Demo Şirketi",invoiceDate:"2024-02-01T00:00:00",dueDate:"2024-03-01T00:00:00",subTotal:15e3,taxAmount:2700,discountAmount:0,totalAmount:17700,currency:"TRY",status:"Sent",items:[],createdAt:"2024-02-01T00:00:00"},{id:"4",invoiceNumber:"INV-2024-004",customerId:"1",customerName:"ABC Teknoloji A.Ş.",invoiceDate:"2024-02-05T00:00:00",dueDate:"2024-03-05T00:00:00",subTotal:8e3,taxAmount:1440,discountAmount:400,totalAmount:9040,currency:"TRY",status:"Draft",items:[],createdAt:"2024-02-05T00:00:00"},{id:"5",invoiceNumber:"INV-2024-005",customerId:"2",customerName:"XYZ Yazılım Ltd.",invoiceDate:"2024-01-10T00:00:00",dueDate:"2024-02-10T00:00:00",subTotal:12e3,taxAmount:2160,discountAmount:600,totalAmount:13560,currency:"TRY",status:"Cancelled",items:[],createdAt:"2024-01-10T00:00:00"}]];i.status&&(e=e.filter(e=>e.status===i.status)),a(e),_(e)}catch(e){d.error("Faturalar yüklenirken hata oluştu")}finally{s(!1)}}),_=e=>{const t=e.reduce((e,t)=>(e.total+=t.totalAmount,"Paid"===t.status?e.paid+=t.totalAmount:"Sent"===t.status||"Draft"===t.status?e.pending+=t.totalAmount:"Overdue"===t.status&&(e.overdue+=t.totalAmount),e),{total:0,paid:0,pending:0,overdue:0});H(t)},ee=(e,t)=>c(null,null,function*(){try{switch(t){case"send":yield K.sendInvoice(e.id),d.success("Fatura gönderildi");break;case"markPaid":yield K.markAsPaid(e.id,{paymentDate:(new Date).toISOString(),paymentMethod:"BankTransfer"}),d.success("Fatura ödendi olarak işaretlendi");break;case"cancel":yield K.cancelInvoice(e.id,"Müşteri talebi"),d.success("Fatura iptal edildi")}U()}catch(a){d.error("İşlem başarısız oldu")}}),te=t=>u.jsxs(L,{children:[u.jsx(L.Item,{icon:u.jsx($,{}),onClick:()=>e(`/invoices/${t.id}`),children:"Görüntüle"},"view"),u.jsx(L.Item,{icon:u.jsx(Z,{}),onClick:()=>e(`/invoices/${t.id}/edit`),children:"Düzenle"},"edit"),u.jsx(L.Divider,{}),"Draft"===t.status&&u.jsx(L.Item,{icon:u.jsx(I,{}),onClick:()=>ee(t,"send"),children:"Gönder"},"send"),"Sent"===t.status&&u.jsx(L.Item,{icon:u.jsx(v,{}),onClick:()=>ee(t,"markPaid"),children:"Ödendi İşaretle"},"markPaid"),u.jsx(L.Item,{icon:u.jsx(N,{}),children:"Yazdır"},"print"),u.jsx(L.Item,{icon:u.jsx(C,{}),children:"PDF İndir"},"download"),u.jsx(L.Divider,{}),"Draft"===t.status&&u.jsx(L.Item,{icon:u.jsx(O,{}),danger:!0,onClick:()=>{return e=t.id,c(null,null,function*(){try{yield K.deleteInvoice(e),d.success("Fatura silindi"),U()}catch(t){d.error("Silme işlemi başarısız oldu")}});var e},children:"Sil"},"delete"),("Sent"===t.status||"Overdue"===t.status)&&u.jsx(L.Item,{icon:u.jsx(g,{}),danger:!0,onClick:()=>ee(t,"cancel"),children:"İptal Et"},"cancel")]}),ae=[{title:"Fatura No",dataIndex:"invoiceNumber",key:"invoiceNumber",fixed:"left",width:120,render:(t,a)=>u.jsx(w,{type:"link",onClick:()=>e(`/invoices/${a.id}`),children:t})},{title:"Müşteri",dataIndex:"customerName",key:"customerName",width:200,render:e=>u.jsxs(S,{children:[u.jsx(G,{style:{backgroundColor:"#87d068"},children:(null==e?void 0:e.charAt(0))||"M"}),u.jsx("span",{children:e||"Müşteri Adı"})]})},{title:"Fatura Tarihi",dataIndex:"invoiceDate",key:"invoiceDate",width:120,render:e=>new Date(e).toLocaleDateString("tr-TR")},{title:"Vade Tarihi",dataIndex:"dueDate",key:"dueDate",width:120,render:(e,t)=>{const a=K.calculateDaysOverdue(e),r="Overdue"===t.status||"Sent"===t.status&&a>0;return u.jsxs(S,{children:[u.jsx("span",{style:{color:r?"#ff4d4f":void 0},children:new Date(e).toLocaleDateString("tr-TR")}),r&&u.jsx(R,{title:`${Math.abs(a)} gün gecikme`,children:u.jsx(g,{style:{color:"#ff4d4f"}})})]})}},{title:"Tutar",dataIndex:"totalAmount",key:"totalAmount",width:150,align:"right",render:(e,t)=>u.jsx("span",{style:{fontWeight:600},children:K.formatCurrency(e,t.currency)}),sorter:(e,t)=>e.totalAmount-t.totalAmount},{title:"Durum",dataIndex:"status",key:"status",width:120,render:e=>{const t={Draft:{color:"default",text:"Taslak"},Sent:{color:"processing",text:"Gönderildi"},Paid:{color:"success",text:"Ödendi"},Overdue:{color:"error",text:"Gecikmiş"},Cancelled:{color:"warning",text:"İptal"}}[e]||{color:"default",text:e};return u.jsx(M,{color:t.color,children:t.text})},filters:[{text:"Taslak",value:"Draft"},{text:"Gönderildi",value:"Sent"},{text:"Ödendi",value:"Paid"},{text:"Gecikmiş",value:"Overdue"},{text:"İptal",value:"Cancelled"}]},{title:"İşlemler",key:"actions",fixed:"right",width:100,render:(e,t)=>u.jsx(B,{overlay:te(t),trigger:["click"],children:u.jsx(w,{icon:u.jsx(V,{})})})}],re={selectedRowKeys:T,onChange:e=>W(e)};return u.jsxs("div",{className:"invoice-list",children:[u.jsxs(x,{gutter:16,className:"statistics-row",children:[u.jsx(m,{xs:24,sm:12,lg:6,children:u.jsx(h,{children:u.jsx(j,{title:"Toplam Fatura",value:t.length,prefix:u.jsx(p,{}),valueStyle:{color:"#1890ff"}})})}),u.jsx(m,{xs:24,sm:12,lg:6,children:u.jsx(h,{children:u.jsx(j,{title:"Ödenen",value:q.paid,prefix:u.jsx(v,{}),valueStyle:{color:"#52c41a"},formatter:e=>K.formatCurrency(e)})})}),u.jsx(m,{xs:24,sm:12,lg:6,children:u.jsx(h,{children:u.jsx(j,{title:"Bekleyen",value:q.pending,prefix:u.jsx(f,{}),valueStyle:{color:"#faad14"},formatter:e=>K.formatCurrency(e)})})}),u.jsx(m,{xs:24,sm:12,lg:6,children:u.jsx(h,{children:u.jsx(j,{title:"Gecikmiş",value:q.overdue,prefix:u.jsx(g,{}),valueStyle:{color:"#ff4d4f"},formatter:e=>K.formatCurrency(e)})})})]}),u.jsxs(h,{title:u.jsxs(S,{children:[u.jsx(z,{}),u.jsx("span",{children:"Faturalar"}),u.jsx(Y,{count:t.length,showZero:!0})]}),extra:u.jsxs(S,{children:[u.jsx(w,{icon:u.jsx(P,{}),children:"Filtrele"}),u.jsx(w,{icon:u.jsx(C,{}),children:"Dışa Aktar"}),u.jsx(w,{type:"primary",icon:u.jsx(F,{}),onClick:()=>e("/invoices/new"),children:"Yeni Fatura"})]}),children:[u.jsxs(x,{gutter:16,className:"filter-row",children:[u.jsx(m,{xs:24,sm:12,lg:6,children:u.jsx(y,{placeholder:"Fatura no veya müşteri ara...",prefix:u.jsx(b,{}),onChange:e=>n(o(l({},i),{pageNumber:1}))})}),u.jsx(m,{xs:24,sm:12,lg:6,children:u.jsxs(k,{placeholder:"Durum seçin",style:{width:"100%"},allowClear:!0,onChange:e=>n(o(l({},i),{status:e,pageNumber:1})),children:[u.jsx(Q,{value:"Draft",children:"Taslak"}),u.jsx(Q,{value:"Sent",children:"Gönderildi"}),u.jsx(Q,{value:"Paid",children:"Ödendi"}),u.jsx(Q,{value:"Overdue",children:"Gecikmiş"}),u.jsx(Q,{value:"Cancelled",children:"İptal"})]})}),u.jsx(m,{xs:24,sm:12,lg:8,children:u.jsx(X,{style:{width:"100%"},placeholder:["Başlangıç","Bitiş"],onChange:e=>{var t,a;e&&n(o(l({},i),{startDate:null==(t=e[0])?void 0:t.toISOString(),endDate:null==(a=e[1])?void 0:a.toISOString(),pageNumber:1}))}})})]}),u.jsx(D,{rowSelection:re,columns:ae,dataSource:t,rowKey:"id",loading:r,scroll:{x:1200},pagination:{current:i.pageNumber,pageSize:i.pageSize,total:2*t.length,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`Toplam ${e} fatura`,onChange:(e,t)=>{n(o(l({},i),{pageNumber:e,pageSize:t}))}},locale:{emptyText:u.jsx(A,{description:"Fatura bulunamadı"})}}),T.length>0&&u.jsx("div",{className:"bulk-actions",children:u.jsxs(S,{children:[u.jsxs("span",{children:[T.length," fatura seçildi"]}),u.jsx(w,{icon:u.jsx(I,{}),children:"Toplu Gönder"}),u.jsx(w,{icon:u.jsx(N,{}),children:"Toplu Yazdır"}),u.jsx(w,{icon:u.jsx(C,{}),children:"PDF İndir"}),u.jsx(w,{danger:!0,icon:u.jsx(O,{}),children:"Sil"})]})})]})]})};export{W as default};
