var j=(f,g,r)=>new Promise((l,y)=>{var m=e=>{try{c(r.next(e))}catch(i){y(i)}},p=e=>{try{c(r.throw(e))}catch(i){y(i)}},c=e=>e.done?l(e.value):Promise.resolve(e.value).then(m,p);c((r=r.apply(f,g)).next())});import{am as x,j as a,O as D,t as C,F as I,u as S,v as E,_ as w,aj as P,w as N}from"./chunk-CQugYT0Y.js";import{m as B,u as M,r as d}from"./chunk-a6Wk6XzP.js";import{a as b}from"../index-BEW7Pg8Q.js";import"./chunk-CX9aqCgN.js";const{Title:V,Paragraph:$}=I,U=()=>{const[f]=B(),g=M(),[r,l]=d.useState("pending"),[y,m]=d.useState(""),[p,c]=d.useState(!1),[e,i]=d.useState(0),t=f.get("email"),h=f.get("token");d.useEffect(()=>{t&&h?G():(l("error"),m("Geçersiz doğrulama linki"))},[t,h]),d.useEffect(()=>{if(e>0){const n=setTimeout(()=>{i(e-1)},1e3);return()=>clearTimeout(n)}},[e]);const G=()=>j(null,null,function*(){var n,u;if(!(!t||!h))try{const s=yield b.verifyEmail({email:t,token:h});s.data.success?(l("success"),x.success(s.data.message||"Email başarıyla doğrulandı!"),setTimeout(()=>{g(s.data.redirectUrl||"/login")},3e3)):(l("error"),m(s.data.message||"Doğrulama başarısız"))}catch(s){l("error"),m(((u=(n=s.response)==null?void 0:n.data)==null?void 0:u.message)||"Doğrulama sırasında bir hata oluştu")}}),z=()=>j(null,null,function*(){var n,u,s,k,T;if(!(!t||p||e>0)){c(!0);try{const o=yield b.resendVerificationEmail({email:t});o.data.success?(x.success(o.data.message||"Doğrulama emaili tekrar gönderildi"),i(60)):x.error(o.data.message||"Email gönderilemedi")}catch(o){if((s=(u=(n=o.response)==null?void 0:n.data)==null?void 0:u.message)!=null&&s.includes("saniye sonra")){const R=o.response.data.message.match(/(\d+) saniye/);R&&i(parseInt(R[1]))}x.error(((T=(k=o.response)==null?void 0:k.data)==null?void 0:T.message)||"Email gönderilemedi")}finally{c(!1)}}}),v=()=>{g("/login")};return a.jsx("div",{className:"email-verification-container",children:a.jsxs(D,{className:"email-verification-card",children:[r==="pending"&&a.jsxs("div",{className:"verification-loading",children:[a.jsx(C,{size:"large"}),a.jsx(V,{level:3,children:"Email Doğrulanıyor..."}),a.jsx($,{children:"Lütfen bekleyin, email adresiniz doğrulanıyor."})]}),r==="success"&&a.jsx(S,{status:"success",icon:a.jsx(w,{style:{color:"#52c41a"}}),title:"Email Başarıyla Doğrulandı!",subTitle:"Hesabınız aktifleştirildi. Giriş sayfasına yönlendiriliyorsunuz...",extra:[a.jsx(E,{type:"primary",onClick:v,children:"Hemen Giriş Yap"},"login")]}),r==="error"&&a.jsx(S,{status:"error",icon:a.jsx(N,{style:{color:"#ff4d4f"}}),title:"Doğrulama Başarısız",subTitle:y,extra:[t&&a.jsx(E,{type:"primary",icon:a.jsx(P,{}),loading:p,disabled:e>0,onClick:z,children:e>0?`Tekrar Gönder (${e}s)`:"Doğrulama Emailini Tekrar Gönder"},"resend"),a.jsx(E,{onClick:v,children:"Giriş Sayfasına Git"},"login")]})]})})};export{U as default};
