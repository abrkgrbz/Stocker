var de=Object.defineProperty,ue=Object.defineProperties;var me=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var G=(r,l,n)=>l in r?de(r,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[l]=n,x=(r,l)=>{for(var n in l||(l={}))xe.call(l,n)&&G(r,n,l[n]);if(L)for(var n of L(l))he.call(l,n)&&G(r,n,l[n]);return r},p=(r,l)=>ue(r,me(l));var b=(r,l,n)=>new Promise((B,N)=>{var M=m=>{try{v(n.next(m))}catch(g){N(g)}},S=m=>{try{v(n.throw(m))}catch(g){N(g)}},v=m=>m.done?B(m.value):Promise.resolve(m.value).then(M,S);v((n=n.apply(r,l)).next())});import{ag as c,y as q,am as w,j as e,t as je,bo as pe,v as T,bs as fe,M as R,N as o,O,F as ye,a_ as Y,ah as y,e as ve,aj as ge,aB as ke,ai as Ie,Y as E,bf as U,aY as be,aW as Te,bg as X,bt as Re,S as Ae,an as Ne,a1 as De,aO as Ce}from"./chunk-CQugYT0Y.js";import{j as Pe,u as we,r as h}from"./chunk-a6Wk6XzP.js";import{a as z}from"./chunk-03cX8L2l.js";import"../index-BEW7Pg8Q.js";import"./chunk-CX9aqCgN.js";const{Title:A,Text:f}=ye,{Option:u}=Y,{TextArea:W}=y,Ee=()=>{const{id:r}=Pe(),l=we(),[n]=c.useForm(),[B,N]=h.useState(!1),[M,S]=h.useState(!1),[v,m]=h.useState([]),[g,Z]=h.useState([]),[d,j]=h.useState([]),[k,J]=h.useState({subTotal:0,taxAmount:0,discountAmount:0,totalAmount:0});h.useEffect(()=>{if(r)Q();else{const t=[{id:"1",productId:"",productName:"",description:"",quantity:1,unitPrice:0,taxRate:18,discountRate:0,totalPrice:0}];j(t),n.setFieldsValue({invoiceDate:q(),dueDate:q().add(30,"days"),paymentMethod:"BankTransfer",items:t})}ee(),te()},[r]),h.useEffect(()=>{H()},[d]);const Q=()=>b(null,null,function*(){try{N(!0);const t={id:r,invoiceNumber:"INV-2024-001",customerId:"1",customerName:"ABC Teknoloji A.Ş.",customerEmail:"muhasebe@abcteknoloji.com",customerPhone:"+90 212 555 0100",customerAddress:`Maslak Mah. Teknoloji Cad. No:15
Sarıyer/İstanbul`,customerTaxNumber:"1234567890",customerTaxOffice:"Sarıyer",invoiceDate:"2024-01-15T00:00:00",dueDate:"2024-02-15T00:00:00",subTotal:1e4,taxAmount:1800,discountAmount:500,totalAmount:11300,currency:"TRY",status:"Draft",paymentMethod:"BankTransfer",notes:"Ödeme IBAN: TR12 0001 2345 6789 0123 4567 89",items:[{id:"1",productId:"1",productName:"Yazılım Lisansı - Pro",description:"Yıllık yazılım lisansı",quantity:2,unitPrice:3e3,taxRate:18,discountRate:5,totalPrice:5700},{id:"2",productId:"2",productName:"Destek Paketi",description:"7/24 teknik destek hizmeti",quantity:1,unitPrice:4e3,taxRate:18,discountRate:0,totalPrice:4720}],createdAt:"2024-01-15T10:30:00"};n.setFieldsValue(p(x({},t),{invoiceDate:q(t.invoiceDate),dueDate:q(t.dueDate)})),j(t.items)}catch(t){w.error("Fatura yüklenemedi")}finally{N(!1)}}),ee=()=>b(null,null,function*(){m([{id:"1",name:"ABC Teknoloji A.Ş.",email:"muhasebe@abcteknoloji.com",phone:"+90 212 555 0100",address:`Maslak Mah. Teknoloji Cad. No:15
Sarıyer/İstanbul`,taxNumber:"1234567890",taxOffice:"Sarıyer"},{id:"2",name:"XYZ Yazılım Ltd.",email:"info@xyzyazilim.com",phone:"+90 216 555 0200",address:"Ataşehir/İstanbul",taxNumber:"9876543210",taxOffice:"Ataşehir"}])}),te=()=>b(null,null,function*(){Z([{id:"1",name:"Yazılım Lisansı - Pro",description:"Yıllık yazılım lisansı",price:3e3,taxRate:18},{id:"2",name:"Destek Paketi",description:"7/24 teknik destek hizmeti",price:4e3,taxRate:18},{id:"3",name:"Eğitim Hizmeti",description:"Uzaktan eğitim (10 saat)",price:5e3,taxRate:18}])}),ae=t=>{const a=v.find(i=>i.id===t);a&&n.setFieldsValue({customerName:a.name,customerEmail:a.email,customerPhone:a.phone,customerAddress:a.address,customerTaxNumber:a.taxNumber,customerTaxOffice:a.taxOffice})},se=(t,a)=>{const i=g.find(s=>s.id===t);if(i){const s=[...d];s[a]=p(x({},s[a]),{productId:i.id,productName:i.name,description:i.description,unitPrice:i.price,taxRate:i.taxRate}),j(s),_(a,s[a])}},_=(t,a)=>{const i=a.quantity||0,s=a.unitPrice||0,I=a.discountRate||0,C=a.taxRate||0,P=i*s,$=P*(I/100),F=P-$,ce=F*(C/100),oe=F+ce,V=[...d];V[t]=p(x(x({},V[t]),a),{totalPrice:oe}),j(V)},H=()=>{let t=0,a=0,i=0;d.forEach(I=>{const C=(I.quantity||0)*(I.unitPrice||0),P=C*((I.discountRate||0)/100),F=(C-P)*((I.taxRate||0)/100);t+=C,i+=P,a+=F});const s=t-i+a;J({subTotal:t,taxAmount:a,discountAmount:i,totalAmount:s})},ie=()=>{const t={id:Date.now().toString(),productId:"",productName:"",description:"",quantity:1,unitPrice:0,taxRate:18,discountRate:0,totalPrice:0};j([...d,t])},ne=t=>{const a=d.filter((i,s)=>s!==t);j(a)},D=(t,a,i)=>{const s=[...d];s[t]=p(x({},s[t]),{[a]:i}),["quantity","unitPrice","discountRate","taxRate"].includes(a)?_(t,s[t]):j(s)},K=t=>b(null,null,function*(){try{S(!0);const a=p(x(p(x({},t),{items:d}),k),{invoiceDate:t.invoiceDate.format("YYYY-MM-DD"),dueDate:t.dueDate.format("YYYY-MM-DD")});r?w.success("Fatura güncellendi"):w.success("Fatura oluşturuldu"),l(-1)}catch(a){w.error("İşlem başarısız")}finally{S(!1)}}),re=t=>b(null,null,function*(){yield K(t),w.info("Fatura kaydedildi ve gönderildi")}),le=()=>{Ce.confirm({title:"İptal Et",content:"Değişiklikler kaybolacak. Devam etmek istiyor musunuz?",okText:"Evet",cancelText:"Hayır",onOk:()=>l(-1)})};return B?e.jsx("div",{style:{textAlign:"center",padding:100},children:e.jsx(je,{size:"large"})}):e.jsxs("div",{className:"invoice-edit-page",children:[e.jsx(pe,{ghost:!1,onBack:()=>l(-1),title:r?"Fatura Düzenle":"Yeni Fatura",extra:[e.jsx(T,{onClick:le,children:"İptal"},"cancel"),e.jsx(T,{onClick:()=>n.submit(),loading:M,children:"Taslak Kaydet"},"save-draft"),e.jsx(T,{type:"primary",icon:e.jsx(fe,{}),onClick:()=>{n.validateFields().then(t=>{re(t)})},loading:M,children:"Kaydet ve Gönder"},"save-send")]}),e.jsx("div",{className:"invoice-edit-content",children:e.jsx(c,{form:n,layout:"vertical",onFinish:K,className:"invoice-form",children:e.jsxs(R,{gutter:24,children:[e.jsx(o,{xs:24,lg:16,children:e.jsxs(O,{title:"Fatura Bilgileri",className:"invoice-card",children:[e.jsx(A,{level:5,children:"Müşteri Bilgileri"}),e.jsxs(R,{gutter:16,children:[e.jsx(o,{span:12,children:e.jsx(c.Item,{name:"customerId",label:"Müşteri Seç",children:e.jsx(Y,{showSearch:!0,placeholder:"Müşteri seçin veya yeni ekleyin",onChange:ae,filterOption:(t,a)=>(a==null?void 0:a.children).toLowerCase().includes(t.toLowerCase()),children:v.map(t=>e.jsx(u,{value:t.id,children:t.name},t.id))})})}),e.jsx(o,{span:12,children:e.jsx(c.Item,{name:"customerName",label:"Müşteri Adı",rules:[{required:!0,message:"Müşteri adı zorunludur"}],children:e.jsx(y,{prefix:e.jsx(ve,{}),placeholder:"Müşteri adı"})})})]}),e.jsxs(R,{gutter:16,children:[e.jsx(o,{span:12,children:e.jsx(c.Item,{name:"customerEmail",label:"Email",rules:[{required:!0,message:"Email zorunludur"},{type:"email",message:"Geçerli email giriniz"}],children:e.jsx(y,{prefix:e.jsx(ge,{}),placeholder:"email@example.com"})})}),e.jsx(o,{span:12,children:e.jsx(c.Item,{name:"customerPhone",label:"Telefon",rules:[{required:!0,message:"Telefon zorunludur"}],children:e.jsx(y,{prefix:e.jsx(ke,{}),placeholder:"+90 5XX XXX XXXX"})})})]}),e.jsx(R,{gutter:16,children:e.jsx(o,{span:24,children:e.jsx(c.Item,{name:"customerAddress",label:"Adres",rules:[{required:!0,message:"Adres zorunludur"}],children:e.jsx(W,{rows:2,placeholder:"Müşteri adresi",prefix:e.jsx(Ie,{})})})})}),e.jsxs(R,{gutter:16,children:[e.jsx(o,{span:12,children:e.jsx(c.Item,{name:"customerTaxNumber",label:"Vergi No",children:e.jsx(y,{placeholder:"Vergi numarası"})})}),e.jsx(o,{span:12,children:e.jsx(c.Item,{name:"customerTaxOffice",label:"Vergi Dairesi",children:e.jsx(y,{placeholder:"Vergi dairesi"})})})]}),e.jsx(E,{}),e.jsx(A,{level:5,children:"Fatura Detayları"}),e.jsxs(R,{gutter:16,children:[e.jsx(o,{span:8,children:e.jsx(c.Item,{name:"invoiceDate",label:"Fatura Tarihi",rules:[{required:!0,message:"Fatura tarihi zorunludur"}],children:e.jsx(U,{style:{width:"100%"},format:"DD.MM.YYYY"})})}),e.jsx(o,{span:8,children:e.jsx(c.Item,{name:"dueDate",label:"Vade Tarihi",rules:[{required:!0,message:"Vade tarihi zorunludur"}],children:e.jsx(U,{style:{width:"100%"},format:"DD.MM.YYYY"})})}),e.jsx(o,{span:8,children:e.jsx(c.Item,{name:"paymentMethod",label:"Ödeme Yöntemi",rules:[{required:!0,message:"Ödeme yöntemi zorunludur"}],children:e.jsxs(Y,{children:[e.jsx(u,{value:"BankTransfer",children:"Banka Havalesi"}),e.jsx(u,{value:"CreditCard",children:"Kredi Kartı"}),e.jsx(u,{value:"Cash",children:"Nakit"}),e.jsx(u,{value:"Check",children:"Çek"})]})})})]}),e.jsx(E,{}),e.jsxs("div",{className:"invoice-items-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(A,{level:5,children:"Ürün/Hizmet Kalemleri"}),e.jsx(T,{type:"dashed",onClick:ie,icon:e.jsx(be,{}),children:"Kalem Ekle"})]}),e.jsx(Te,{dataSource:d,pagination:!1,rowKey:"id",className:"invoice-items-table",columns:[{title:"Ürün/Hizmet",dataIndex:"productName",width:250,render:(t,a,i)=>e.jsxs("div",{children:[e.jsx(Y,{style:{width:"100%",marginBottom:8},placeholder:"Ürün seçin",value:a.productId,onChange:s=>se(s,i),showSearch:!0,children:g.map(s=>e.jsx(u,{value:s.id,children:s.name},s.id))}),e.jsx(y,{placeholder:"Açıklama",value:a.description,onChange:s=>D(i,"description",s.target.value)})]})},{title:"Miktar",dataIndex:"quantity",width:100,render:(t,a,i)=>e.jsx(X,{min:1,value:a.quantity,onChange:s=>D(i,"quantity",s)})},{title:"Birim Fiyat",dataIndex:"unitPrice",width:120,render:(t,a,i)=>e.jsx(X,{min:0,value:a.unitPrice,onChange:s=>D(i,"unitPrice",s),formatter:s=>`₺ ${s}`,parser:s=>s.replace("₺ ","")})},{title:"İndirim %",dataIndex:"discountRate",width:100,render:(t,a,i)=>e.jsx(X,{min:0,max:100,value:a.discountRate,onChange:s=>D(i,"discountRate",s),formatter:s=>`${s}%`,parser:s=>s.replace("%","")})},{title:"KDV %",dataIndex:"taxRate",width:100,render:(t,a,i)=>e.jsxs(Y,{value:a.taxRate,onChange:s=>D(i,"taxRate",s),children:[e.jsx(u,{value:0,children:"%0"}),e.jsx(u,{value:1,children:"%1"}),e.jsx(u,{value:8,children:"%8"}),e.jsx(u,{value:18,children:"%18"})]})},{title:"Toplam",dataIndex:"totalPrice",width:120,render:t=>e.jsx(f,{strong:!0,children:z(t||0)})},{title:"",width:50,render:(t,a,i)=>e.jsx(T,{type:"text",danger:!0,icon:e.jsx(Re,{}),onClick:()=>ne(i),disabled:d.length===1})}]})]}),e.jsx(E,{}),e.jsx(A,{level:5,children:"Notlar"}),e.jsx(c.Item,{name:"notes",children:e.jsx(W,{rows:3,placeholder:"Fatura ile ilgili notlar (isteğe bağlı)"})})]})}),e.jsxs(o,{xs:24,lg:8,children:[e.jsx(O,{title:"Fatura Özeti",className:"summary-card",children:e.jsxs("div",{className:"summary-content",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx(f,{children:"Ara Toplam:"}),e.jsx(f,{strong:!0,children:z(k.subTotal)})]}),k.discountAmount>0&&e.jsxs("div",{className:"summary-item",children:[e.jsx(f,{children:"İndirim:"}),e.jsxs(f,{type:"danger",children:["-",z(k.discountAmount)]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx(f,{children:"KDV:"}),e.jsx(f,{children:z(k.taxAmount)})]}),e.jsx(E,{}),e.jsxs("div",{className:"summary-item total",children:[e.jsx(A,{level:4,children:"Genel Toplam:"}),e.jsx(A,{level:4,style:{color:"#1890ff",margin:0},children:z(k.totalAmount)})]})]})}),e.jsx(O,{title:"Hızlı İşlemler",style:{marginTop:16},children:e.jsxs(Ae,{direction:"vertical",style:{width:"100%"},children:[e.jsx(Ne,{message:"Fatura Durumu",description:r?"Taslak olarak kaydedilmiş":"Henüz kaydedilmemiş",type:"info",showIcon:!0}),e.jsx(T,{block:!0,icon:e.jsx(De,{}),onClick:H,children:"Toplamları Yeniden Hesapla"})]})})]})]})})})]})};export{Ee as InvoiceEdit,Ee as default};
