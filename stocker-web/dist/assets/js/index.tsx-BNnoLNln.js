var e=Object.defineProperty,l=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(l,s,a)=>s in l?e(l,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[s]=a,t=(e,l,s)=>new Promise((a,r)=>{var i=e=>{try{t(s.next(e))}catch(l){r(l)}},n=e=>{try{t(s.throw(e))}catch(l){r(l)}},t=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,n);t((s=s.apply(e,l)).next())});import{ay as c,aD as o,j as d,q as u,$ as m,aQ as h,ac as x,Z as j,S as p,c as f,b8 as y,bj as g,a2 as b,a3 as v,a5 as A,bi as k,I as w,g as N,b6 as S,bq as I,bd as D,b1 as K,bl as z,bH as C,bz as P,O as T,aZ as M,by as Y,Y as E,U as F,aj as O,bI as U,be as R,B as q,A as H,o as $,aA as L,as as G,T as V,D as B,bc as Z,M as J,bn as Q,bJ as _,bu as W,bg as X,y as ee,bK as le}from"./chunk-Bx2_2m46.js";import{r as se}from"./chunk-nBmrMGrr.js";import{c as ae}from"../index-BqMev2MT.js";/* empty css              */import{m as re}from"./chunk-DFuNhjAk.js";import"./chunk-BsETiAjl.js";const ie=e=>ae.get("/api/master/MasterUsers",{params:e}),ne=e=>ae.post("/api/master/MasterUsers",e),te=(e,l)=>ae.put(`/api/master/MasterUsers/${e}`,l),ce=e=>ae.delete(`/api/master/MasterUsers/${e}`),oe=e=>ae.post(`/api/master/MasterUsers/${e}/toggle-status`),de=(e,l)=>ae.post(`/api/master/MasterUsers/${e}/reset-password`,{newPassword:l});F.extend(le),F.locale("tr");const{Title:ue,Text:me,Paragraph:he}=j,{TabPane:xe}=M,{Option:je}=S,pe=()=>{const[e,j]=se.useState([]),[le,ae]=se.useState(!1),[he,pe]=se.useState(!1),[fe,ye]=se.useState(!1),[ge,be]=se.useState(!1),[ve,Ae]=se.useState(null),[ke,we]=se.useState(""),[Ne,Se]=se.useState(""),[Ie,De]=se.useState(),[Ke,ze]=se.useState(!1),[Ce]=c.useForm(),[Pe]=c.useForm(),[Te,Me]=se.useState({current:1,pageSize:10,total:0});se.useEffect(()=>{Ye()},[Te.current,Te.pageSize,ke,Ne,Ie]);const Ye=()=>t(null,null,function*(){var e,t;ae(!0);try{const c=yield ie({page:Te.current,pageSize:Te.pageSize,search:ke,role:Ne,isActive:Ie});if((null==(e=c.data)?void 0:e.success)&&(null==(t=c.data)?void 0:t.data)){const e=c.data.data.map(e=>({id:e.id,username:e.username||e.userName,email:e.email,firstName:e.firstName,lastName:e.lastName,phoneNumber:e.phoneNumber,role:e.role||"User",isActive:e.isActive,isTwoFactorEnabled:e.isTwoFactorEnabled||!1,lastLoginDate:e.lastLoginDate,createdDate:e.createdDate||e.createdAt,tenantAccess:e.tenantAccess||[]}));j(e),Me(t=>{return o=((e,l)=>{for(var s in l||(l={}))r.call(l,s)&&n(e,s,l[s]);if(a)for(var s of a(l))i.call(l,s)&&n(e,s,l[s]);return e})({},t),d={total:c.data.totalCount||e.length},l(o,s(d));var o,d})}}catch(c){o.error("Kullanıcılar yüklenirken hata oluştu")}finally{ae(!1)}}),Ee=e=>({SuperAdmin:"purple",Admin:"red",Support:"blue",User:"green",Viewer:"default"}[e]||"default"),Fe=e=>({SuperAdmin:d.jsx(ee,{}),Admin:d.jsx(h,{}),Support:d.jsx(u,{}),User:d.jsx($,{}),Viewer:d.jsx(z,{})}[e]||d.jsx($,{})),Oe=[{title:"Toplam Kullanıcı",value:e.length,icon:d.jsx(u,{}),color:"#1890ff"},{title:"Aktif Kullanıcı",value:e.filter(e=>e.isActive).length,icon:d.jsx(m,{}),color:"#52c41a"},{title:"Admin Kullanıcı",value:e.filter(e=>"Admin"===e.role||"SuperAdmin"===e.role).length,icon:d.jsx(h,{}),color:"#722ed1"},{title:"2FA Aktif",value:e.filter(e=>e.isTwoFactorEnabled).length,icon:d.jsx(x,{}),color:"#fa8c16"}],Ue=[{title:"Kullanıcı",key:"user",render:e=>{var l,s;return d.jsxs(p,{children:[d.jsx(q,{dot:!0,status:e.isActive?"success":"error",offset:[-5,5],children:d.jsxs(H,{icon:d.jsx($,{}),style:{backgroundColor:"#1890ff"},children:[null==(l=e.firstName)?void 0:l[0],null==(s=e.lastName)?void 0:s[0]]})}),d.jsxs("div",{children:[d.jsx(me,{strong:!0,children:`${e.firstName} ${e.lastName}`}),d.jsx("br",{}),d.jsxs(me,{type:"secondary",style:{fontSize:12},children:["@",e.username]})]})]})}},{title:"E-posta",dataIndex:"email",key:"email",render:e=>d.jsxs(p,{children:[d.jsx(L,{}),d.jsx(me,{children:e})]})},{title:"Telefon",dataIndex:"phoneNumber",key:"phoneNumber",render:e=>e?d.jsxs(p,{children:[d.jsx(G,{}),d.jsx(me,{children:e})]}):d.jsx(me,{type:"secondary",children:"-"})},{title:"Rol",dataIndex:"role",key:"role",render:e=>d.jsx(E,{color:Ee(e),icon:Fe(e),children:e})},{title:"Güvenlik",key:"security",render:e=>d.jsxs(p,{children:[e.isTwoFactorEnabled&&d.jsx(V,{title:"2FA Aktif",children:d.jsx(E,{color:"green",icon:d.jsx(x,{}),children:"2FA"})}),e.tenantAccess&&e.tenantAccess.length>0&&d.jsx(V,{title:`${e.tenantAccess.length} Tenant Erişimi`,children:d.jsx(E,{color:"blue",icon:d.jsx(U,{}),children:e.tenantAccess.length})})]})},{title:"Son Giriş",dataIndex:"lastLoginDate",key:"lastLoginDate",render:e=>e?d.jsx(V,{title:F(e).format("DD MMMM YYYY HH:mm"),children:d.jsx(me,{type:"secondary",children:F(e).fromNow()})}):d.jsx(me,{type:"secondary",children:"Hiç giriş yapmadı"})},{title:"Durum",dataIndex:"isActive",key:"isActive",render:e=>d.jsx(E,{color:e?"success":"error",children:e?"Aktif":"Pasif"})},{title:"İşlemler",key:"actions",width:120,render:e=>d.jsx(B,{overlay:d.jsxs(J,{children:[d.jsx(J.Item,{icon:d.jsx(z,{}),onClick:()=>Le(e),children:"Detaylar"},"view"),d.jsx(J.Item,{icon:d.jsx(Q,{}),onClick:()=>Re(e),children:"Düzenle"},"edit"),d.jsx(J.Item,{icon:d.jsx(_,{}),onClick:()=>$e(e),children:"Şifre Sıfırla"},"password"),d.jsx(J.Divider,{}),d.jsx(J.Item,{icon:e.isActive?d.jsx(x,{}):d.jsx(W,{}),onClick:()=>qe(e),children:e.isActive?"Devre Dışı Bırak":"Aktif Et"},"toggle"),d.jsx(J.Divider,{}),d.jsx(J.Item,{icon:d.jsx(X,{}),danger:!0,onClick:()=>He(e.id),children:"Sil"},"delete")]}),placement:"bottomRight",children:d.jsx(f,{type:"text",icon:d.jsx(Z,{})})})}],Re=e=>{Ae(e),Ce.setFieldsValue({firstName:e.firstName,lastName:e.lastName,email:e.email,username:e.username,phoneNumber:e.phoneNumber,role:e.role,isActive:e.isActive}),pe(!0)},qe=e=>t(null,null,function*(){try{yield oe(e.id),o.success("Kullanıcı "+(e.isActive?"devre dışı bırakıldı":"aktif edildi")),Ye()}catch(l){o.error("Durum değiştirilemedi")}}),He=e=>t(null,null,function*(){K.confirm({title:"Kullanıcıyı Sil",content:"Bu kullanıcıyı silmek istediğinizden emin misiniz?",okText:"Sil",okType:"danger",cancelText:"İptal",onOk:()=>t(null,null,function*(){try{yield ce(e),o.success("Kullanıcı silindi"),Ye()}catch(l){o.error("Kullanıcı silinemedi")}})})}),$e=e=>{Ae(e),Pe.resetFields(),ye(!0)},Le=e=>{Ae(e),be(!0)};return d.jsxs("div",{className:"master-users-page",children:[d.jsxs("div",{className:"page-header glass-morphism",children:[d.jsxs(re.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"header-content",children:[d.jsxs(ue,{level:2,className:"gradient-text",children:[d.jsx(u,{})," Kullanıcı Yönetimi"]}),d.jsx(me,{type:"secondary",children:"Sistem kullanıcılarını yönetin"})]}),d.jsx(re.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},className:"header-actions",children:d.jsxs(p,{children:[d.jsx(f,{icon:d.jsx(y,{}),children:"Dışa Aktar"}),d.jsx(f,{type:"primary",icon:d.jsx(g,{}),onClick:()=>{Ce.resetFields(),Ae(null),pe(!0)},className:"gradient-button",children:"Yeni Kullanıcı"})]})})]}),d.jsx(b,{gutter:[20,20],className:"stats-row",children:Oe.map((e,l)=>d.jsx(v,{xs:24,sm:12,lg:6,children:d.jsx(re.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*l},children:d.jsx(A,{className:"stat-card glass-morphism",children:d.jsx(k,{title:e.title,value:e.value,prefix:d.jsx("span",{style:{color:e.color,marginRight:8},children:e.icon}),valueStyle:{color:e.color}})})})},l))}),d.jsx(A,{className:"filter-card glass-morphism",children:d.jsxs(b,{gutter:[16,16],align:"middle",children:[d.jsx(v,{flex:"auto",children:d.jsxs(p,{size:"middle",children:[d.jsx(w,{placeholder:"Kullanıcı ara...",prefix:d.jsx(N,{}),value:ke,onChange:e=>we(e.target.value),style:{width:250},allowClear:!0}),d.jsxs(S,{placeholder:"Rol",value:Ne,onChange:Se,style:{width:150},allowClear:!0,children:[d.jsx(je,{value:"SuperAdmin",children:"Super Admin"}),d.jsx(je,{value:"Admin",children:"Admin"}),d.jsx(je,{value:"Support",children:"Destek"}),d.jsx(je,{value:"User",children:"Kullanıcı"}),d.jsx(je,{value:"Viewer",children:"İzleyici"})]}),d.jsxs(S,{placeholder:"Durum",value:Ie,onChange:De,style:{width:120},allowClear:!0,children:[d.jsx(je,{value:!0,children:"Aktif"}),d.jsx(je,{value:!1,children:"Pasif"})]})]})}),d.jsx(v,{children:d.jsx(f,{icon:d.jsx(I,{}),onClick:Ye,loading:le,children:"Yenile"})})]})}),d.jsx(A,{className:"table-card glass-morphism",children:d.jsx(D,{columns:Ue,dataSource:e,rowKey:"id",loading:le,pagination:Te,onChange:e=>{Me({current:e.current,pageSize:e.pageSize,total:Te.total})}})}),d.jsx(K,{title:ve?"Kullanıcı Düzenle":"Yeni Kullanıcı",open:he,onCancel:()=>pe(!1),footer:null,width:600,children:d.jsxs(c,{form:Ce,layout:"vertical",onFinish:e=>t(null,null,function*(){ae(!0);try{if(ve){const l={firstName:e.firstName,lastName:e.lastName,email:e.email,phoneNumber:e.phoneNumber,role:e.role,isActive:e.isActive};yield te(ve.id,l),o.success("Kullanıcı güncellendi")}else{const l={username:e.username,email:e.email,password:e.password,firstName:e.firstName,lastName:e.lastName,phoneNumber:e.phoneNumber,role:e.role,isActive:!1!==e.isActive};yield ne(l),o.success("Kullanıcı oluşturuldu")}pe(!1),Ye()}catch(l){o.error(ve?"Kullanıcı güncellenemedi":"Kullanıcı oluşturulamadı")}finally{ae(!1)}}),children:[d.jsxs(b,{gutter:16,children:[d.jsx(v,{span:12,children:d.jsx(c.Item,{name:"firstName",label:"Ad",rules:[{required:!0,message:"Ad zorunlu"}],children:d.jsx(w,{placeholder:"Ad"})})}),d.jsx(v,{span:12,children:d.jsx(c.Item,{name:"lastName",label:"Soyad",rules:[{required:!0,message:"Soyad zorunlu"}],children:d.jsx(w,{placeholder:"Soyad"})})})]}),!ve&&d.jsx(c.Item,{name:"username",label:"Kullanıcı Adı",rules:[{required:!0,message:"Kullanıcı adı zorunlu"},{min:3,message:"En az 3 karakter olmalı"}],children:d.jsx(w,{placeholder:"Kullanıcı adı"})}),d.jsx(c.Item,{name:"email",label:"E-posta",rules:[{required:!0,message:"E-posta zorunlu"},{type:"email",message:"Geçerli bir e-posta girin"}],children:d.jsx(w,{placeholder:"E-posta"})}),!ve&&d.jsx(c.Item,{name:"password",label:"Şifre",rules:[{required:!0,message:"Şifre zorunlu"},{min:6,message:"En az 6 karakter olmalı"}],children:d.jsx(w.Password,{placeholder:"Şifre",iconRender:e=>e?d.jsx(z,{}):d.jsx(C,{})})}),d.jsx(c.Item,{name:"phoneNumber",label:"Telefon",children:d.jsx(w,{placeholder:"Telefon numarası"})}),d.jsxs(b,{gutter:16,children:[d.jsx(v,{span:12,children:d.jsx(c.Item,{name:"role",label:"Rol",rules:[{required:!0,message:"Rol seçimi zorunlu"}],children:d.jsxs(S,{placeholder:"Rol seçin",children:[d.jsx(je,{value:"Admin",children:"Admin"}),d.jsx(je,{value:"Support",children:"Destek"}),d.jsx(je,{value:"User",children:"Kullanıcı"}),d.jsx(je,{value:"Viewer",children:"İzleyici"})]})})}),d.jsx(v,{span:12,children:d.jsx(c.Item,{name:"isActive",label:"Durum",valuePropName:"checked",initialValue:!0,children:d.jsx(P,{checkedChildren:"Aktif",unCheckedChildren:"Pasif"})})})]}),d.jsx(c.Item,{children:d.jsxs(p,{style:{width:"100%",justifyContent:"flex-end"},children:[d.jsx(f,{onClick:()=>pe(!1),children:"İptal"}),d.jsx(f,{type:"primary",htmlType:"submit",loading:le,children:ve?"Güncelle":"Oluştur"})]})})]})}),d.jsxs(K,{title:"Şifre Sıfırla",open:fe,onCancel:()=>ye(!1),footer:null,width:400,children:[d.jsx(T,{message:`${null==ve?void 0:ve.firstName} ${null==ve?void 0:ve.lastName} kullanıcısının şifresini sıfırlıyorsunuz`,type:"info",showIcon:!0,style:{marginBottom:16}}),d.jsxs(c,{form:Pe,layout:"vertical",onFinish:e=>t(null,null,function*(){if(ve){ae(!0);try{yield de(ve.id,e.newPassword),o.success("Şifre başarıyla sıfırlandı"),ye(!1)}catch(l){o.error("Şifre sıfırlanamadı")}finally{ae(!1)}}}),children:[d.jsx(c.Item,{name:"newPassword",label:"Yeni Şifre",rules:[{required:!0,message:"Şifre zorunlu"},{min:6,message:"En az 6 karakter olmalı"}],children:d.jsx(w.Password,{placeholder:"Yeni şifre",iconRender:e=>e?d.jsx(z,{}):d.jsx(C,{})})}),d.jsx(c.Item,{name:"confirmPassword",label:"Şifre Tekrar",dependencies:["newPassword"],rules:[{required:!0,message:"Şifre tekrarı zorunlu"},({getFieldValue:e})=>({validator:(l,s)=>s&&e("newPassword")!==s?Promise.reject(new Error("Şifreler eşleşmiyor")):Promise.resolve()})],children:d.jsx(w.Password,{placeholder:"Şifre tekrar",iconRender:e=>e?d.jsx(z,{}):d.jsx(C,{})})}),d.jsx(c.Item,{children:d.jsxs(p,{style:{width:"100%",justifyContent:"flex-end"},children:[d.jsx(f,{onClick:()=>ye(!1),children:"İptal"}),d.jsx(f,{type:"primary",htmlType:"submit",loading:le,children:"Şifreyi Sıfırla"})]})})]})]}),d.jsx(K,{title:"Kullanıcı Detayları",open:ge,onCancel:()=>be(!1),footer:[d.jsx(f,{onClick:()=>be(!1),children:"Kapat"},"close")],width:700,children:ve&&d.jsxs(M,{defaultActiveKey:"1",children:[d.jsx(xe,{tab:"Genel Bilgiler",children:d.jsxs(Y,{bordered:!0,column:2,children:[d.jsxs(Y.Item,{label:"Ad Soyad",span:2,children:[ve.firstName," ",ve.lastName]}),d.jsxs(Y.Item,{label:"Kullanıcı Adı",children:["@",ve.username]}),d.jsx(Y.Item,{label:"Rol",children:d.jsx(E,{color:Ee(ve.role),children:ve.role})}),d.jsx(Y.Item,{label:"E-posta",children:ve.email}),d.jsx(Y.Item,{label:"Telefon",children:ve.phoneNumber||"-"}),d.jsx(Y.Item,{label:"Durum",children:d.jsx(E,{color:ve.isActive?"success":"error",children:ve.isActive?"Aktif":"Pasif"})}),d.jsx(Y.Item,{label:"2FA",children:d.jsx(E,{color:ve.isTwoFactorEnabled?"success":"default",children:ve.isTwoFactorEnabled?"Aktif":"Pasif"})}),d.jsx(Y.Item,{label:"Kayıt Tarihi",span:2,children:F(ve.createdDate).format("DD MMMM YYYY HH:mm")}),d.jsx(Y.Item,{label:"Son Giriş",span:2,children:ve.lastLoginDate?F(ve.lastLoginDate).format("DD MMMM YYYY HH:mm"):"Henüz giriş yapmadı"})]})},"1"),d.jsx(xe,{tab:"Tenant Erişimleri",children:ve.tenantAccess&&ve.tenantAccess.length>0?d.jsx(O,{dataSource:ve.tenantAccess,renderItem:e=>d.jsx(O.Item,{children:d.jsx(O.Item.Meta,{avatar:d.jsx(U,{}),title:e,description:"Erişim yetkisi var"})})}):d.jsx(T,{message:"Tenant Erişimi Yok",description:"Bu kullanıcının herhangi bir tenant'a erişimi bulunmuyor.",type:"info",showIcon:!0})},"2"),d.jsx(xe,{tab:"İşlem Geçmişi",children:d.jsxs(R,{children:[d.jsxs(R.Item,{color:"green",children:["Hesap oluşturuldu - ",F(ve.createdDate).format("DD MMMM YYYY")]}),ve.lastLoginDate&&d.jsxs(R.Item,{color:"blue",children:["Son giriş - ",F(ve.lastLoginDate).fromNow()]})]})},"3")]})})]})};export{pe as MasterUsersPage};
