var e=Object.defineProperty,i=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(i,t,r)=>t in i?e(i,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):i[t]=r,l=(e,i)=>{for(var t in i||(i={}))a.call(i,t)&&s(e,t,i[t]);if(r)for(var t of r(i))n.call(i,t)&&s(e,t,i[t]);return e},c=(e,r)=>i(e,t(r));import{ag as d,j as o,y as u,M as m,N as x,O as h,ah as j,p,b9 as y,Y as v,av as g,S as k,A as b,e as f,F as w,an as z,v as I,aT as N,aR as P,a1 as D,bh as S,aO as T,aJ as Y,s as A,am as F,ba as C,b0 as O}from"./chunk-BQg_R8tr.js";import{u as M,r as R}from"./chunk-nBmrMGrr.js";import{i as q}from"./chunk-B078Ffin.js";import"./chunk-C24t1M9j.js";import"./chunk-BsETiAjl.js";const{TextArea:E}=j,{Option:B}=g,{Title:H,Text:V}=w,K=[{id:"1",name:"ABC Teknoloji A.Ş.",email:"info@abc.com",phone:"0212 555 0001",taxNumber:"1234567890"},{id:"2",name:"XYZ Yazılım Ltd.",email:"contact@xyz.com",phone:"0216 555 0002",taxNumber:"0987654321"},{id:"3",name:"Demo Şirketi",email:"demo@demo.com",phone:"0312 555 0003",taxNumber:"1122334455"}],U=[{id:"1",name:"Yazılım Lisansı",price:5e3,description:"Yıllık yazılım lisansı"},{id:"2",name:"Danışmanlık Hizmeti",price:1500,description:"Saatlik danışmanlık ücreti"},{id:"3",name:"Eğitim Paketi",price:1e4,description:"3 günlük eğitim paketi"},{id:"4",name:"Destek Hizmeti",price:2e3,description:"Aylık teknik destek"}],$=()=>{const[e]=d.useForm(),i=M(),[t,r]=R.useState(!1),[a,n]=R.useState([]),[s,w]=R.useState(null),[$,L]=R.useState({subTotal:0,taxAmount:0,discountAmount:0,totalAmount:0}),[G,J]=R.useState(!1),X=e=>{let i=0,t=0,r=0;e.forEach(e=>{const a=e.quantity*e.unitPrice,n=a*((e.discountPercentage||0)/100),s=(a-n)*((e.taxRate||0)/100);i+=a,r+=n,t+=s});L({subTotal:i,taxAmount:t,discountAmount:r,totalAmount:i-r+t})},Z=(e,i,t)=>{const r=[...a];r[e]=c(l({},r[e]),{[i]:t}),n(r),X(r)},Q=[{title:"Ürün/Hizmet",dataIndex:"productName",key:"productName",width:"25%"},{title:"Açıklama",dataIndex:"description",key:"description",width:"20%",render:(e,i,t)=>o.jsx(j,{value:i.description,onChange:e=>Z(t,"description",e.target.value),placeholder:"Açıklama..."})},{title:"Miktar",dataIndex:"quantity",key:"quantity",width:"10%",render:(e,i,t)=>o.jsx(C,{min:.01,value:i.quantity,onChange:e=>Z(t,"quantity",e)})},{title:"Birim Fiyat",dataIndex:"unitPrice",key:"unitPrice",width:"12%",render:(e,i,t)=>o.jsx(C,{min:0,value:i.unitPrice,onChange:e=>Z(t,"unitPrice",e),formatter:e=>`₺ ${e}`.replace(/\B(?=(\d{3})+(?!\d))/g,",")})},{title:"İndirim %",dataIndex:"discountPercentage",key:"discountPercentage",width:"10%",render:(e,i,t)=>o.jsx(C,{min:0,max:100,value:i.discountPercentage,onChange:e=>Z(t,"discountPercentage",e),formatter:e=>`${e}%`})},{title:"KDV %",dataIndex:"taxRate",key:"taxRate",width:"10%",render:(e,i,t)=>o.jsxs(g,{value:i.taxRate,onChange:e=>Z(t,"taxRate",e),style:{width:"100%"},children:[o.jsx(B,{value:0,children:"%0"}),o.jsx(B,{value:1,children:"%1"}),o.jsx(B,{value:8,children:"%8"}),o.jsx(B,{value:18,children:"%18"})]})},{title:"Toplam",key:"total",width:"10%",align:"right",render:(e,i)=>{const t=i.quantity*i.unitPrice,r=t-t*((i.discountPercentage||0)/100),a=r*((i.taxRate||0)/100);return o.jsxs(V,{strong:!0,children:["₺",(r+a).toFixed(2)]})}},{title:"",key:"action",width:"3%",render:(e,i,t)=>o.jsx(I,{type:"text",danger:!0,icon:o.jsx(O,{}),onClick:()=>(e=>{const i=a.filter((i,t)=>t!==e);n(i),X(i)})(t)})}];return o.jsxs("div",{className:"create-invoice",children:[o.jsx(d,{form:e,layout:"vertical",onFinish:e=>{return t=null,n=null,s=function*(){if(0!==a.length)try{r(!0);const t=c(l({},e),{invoiceDate:e.invoiceDate.toISOString(),dueDate:e.dueDate.toISOString(),items:a}),n=yield q.createInvoice(t);F.success("Fatura başarıyla oluşturuldu"),e.sendImmediately&&(yield q.sendInvoice(n.id),F.success("Fatura müşteriye gönderildi")),i("/invoices")}catch(t){F.error("Fatura oluşturulurken hata oluştu")}finally{r(!1)}else F.warning("En az bir ürün/hizmet eklemelisiniz")},new Promise((e,i)=>{var r=e=>{try{l(s.next(e))}catch(t){i(t)}},a=e=>{try{l(s.throw(e))}catch(t){i(t)}},l=i=>i.done?e(i.value):Promise.resolve(i.value).then(r,a);l((s=s.apply(t,n)).next())});var t,n,s},initialValues:{currency:"TRY",invoiceDate:u(),dueDate:u().add(30,"days"),invoiceNumber:`INV-${(new Date).getFullYear()}-${String(Math.floor(1e4*Math.random())).padStart(4,"0")}`},children:o.jsxs(m,{gutter:24,children:[o.jsx(x,{xs:24,lg:16,children:o.jsxs(h,{title:o.jsxs(k,{children:[o.jsx(p,{}),o.jsx("span",{children:"Yeni Fatura Oluştur"})]}),className:"invoice-form-card",children:[o.jsxs(m,{gutter:16,children:[o.jsx(x,{xs:24,md:8,children:o.jsx(d.Item,{name:"invoiceNumber",label:"Fatura No",rules:[{required:!0,message:"Fatura no zorunludur"}],children:o.jsx(j,{prefix:o.jsx(p,{})})})}),o.jsx(x,{xs:24,md:8,children:o.jsx(d.Item,{name:"invoiceDate",label:"Fatura Tarihi",rules:[{required:!0,message:"Fatura tarihi zorunludur"}],children:o.jsx(y,{style:{width:"100%"},format:"DD/MM/YYYY"})})}),o.jsx(x,{xs:24,md:8,children:o.jsx(d.Item,{name:"dueDate",label:"Vade Tarihi",rules:[{required:!0,message:"Vade tarihi zorunludur"}],children:o.jsx(y,{style:{width:"100%"},format:"DD/MM/YYYY"})})})]}),o.jsx(v,{children:"Müşteri Bilgileri"}),o.jsx(m,{gutter:16,children:o.jsx(x,{xs:24,children:o.jsx(d.Item,{name:"customerId",label:"Müşteri",rules:[{required:!0,message:"Müşteri seçimi zorunludur"}],children:o.jsx(g,{showSearch:!0,placeholder:"Müşteri seçin veya arayın",optionFilterProp:"children",onChange:e=>{const i=K.find(i=>i.id===e);w(i)},children:K.map(e=>o.jsx(B,{value:e.id,children:o.jsxs(k,{children:[o.jsx(b,{icon:o.jsx(f,{}),size:"small"}),o.jsxs("div",{children:[o.jsx("div",{children:e.name}),o.jsxs(V,{type:"secondary",style:{fontSize:12},children:[e.email," | ",e.phone]})]})]})},e.id))})})})}),s&&o.jsx(z,{message:"Seçili Müşteri",description:o.jsxs(k,{direction:"vertical",size:"small",children:[o.jsx(V,{children:s.name}),o.jsxs(V,{type:"secondary",children:[s.email," | ",s.phone]}),o.jsxs(V,{type:"secondary",children:["Vergi No: ",s.taxNumber]})]}),type:"info",showIcon:!0,icon:o.jsx(f,{}),style:{marginBottom:16}}),o.jsx(v,{children:"Ürün/Hizmetler"}),o.jsx(I,{type:"dashed",onClick:()=>{J(!0)},icon:o.jsx(N,{}),style:{width:"100%",marginBottom:16},children:"Ürün/Hizmet Ekle"}),o.jsx(P,{dataSource:a,columns:Q,pagination:!1,rowKey:(e,i)=>(null==i?void 0:i.toString())||"0",locale:{emptyText:"Henüz ürün/hizmet eklenmedi"}}),o.jsx(v,{children:"Ek Bilgiler"}),o.jsxs(m,{gutter:16,children:[o.jsx(x,{xs:24,md:12,children:o.jsx(d.Item,{name:"notes",label:"Notlar",children:o.jsx(E,{rows:4,placeholder:"Fatura ile ilgili notlar..."})})}),o.jsx(x,{xs:24,md:12,children:o.jsx(d.Item,{name:"terms",label:"Şartlar ve Koşullar",children:o.jsx(E,{rows:4,placeholder:"Ödeme şartları, teslimat koşulları vb..."})})})]})]})}),o.jsxs(x,{xs:24,lg:8,children:[o.jsxs(h,{className:"invoice-summary-card",children:[o.jsxs(H,{level:4,children:[o.jsx(D,{})," Fatura Özeti"]}),o.jsxs("div",{className:"summary-items",children:[o.jsxs("div",{className:"summary-item",children:[o.jsx(V,{children:"Ara Toplam:"}),o.jsx(V,{strong:!0,children:q.formatCurrency($.subTotal)})]}),o.jsxs("div",{className:"summary-item",children:[o.jsx(V,{children:"İndirim:"}),o.jsxs(V,{type:"danger",children:["-",q.formatCurrency($.discountAmount)]})]}),o.jsxs("div",{className:"summary-item",children:[o.jsx(V,{children:"KDV:"}),o.jsx(V,{children:q.formatCurrency($.taxAmount)})]}),o.jsx(v,{}),o.jsxs("div",{className:"summary-item total",children:[o.jsx(H,{level:5,children:"Genel Toplam:"}),o.jsx(H,{level:4,type:"success",children:q.formatCurrency($.totalAmount)})]})]}),o.jsx(v,{}),o.jsx(d.Item,{name:"currency",label:"Para Birimi",children:o.jsxs(g,{children:[o.jsx(B,{value:"TRY",children:"TRY - Türk Lirası"}),o.jsx(B,{value:"USD",children:"USD - Amerikan Doları"}),o.jsx(B,{value:"EUR",children:"EUR - Euro"})]})}),o.jsx(d.Item,{name:"sendImmediately",valuePropName:"checked",children:o.jsxs(k,{children:[o.jsx("input",{type:"checkbox"}),o.jsx(V,{children:"Oluşturduktan sonra hemen gönder"})]})}),o.jsxs(k,{direction:"vertical",style:{width:"100%"},children:[o.jsx(I,{type:"primary",htmlType:"submit",loading:t,icon:o.jsx(S,{}),size:"large",block:!0,children:"Faturayı Oluştur"}),o.jsx(I,{onClick:()=>i("/invoices"),size:"large",block:!0,children:"İptal"})]})]}),o.jsxs(h,{style:{marginTop:16},children:[o.jsx(H,{level:5,children:"Bu Ay"}),o.jsxs(m,{gutter:16,children:[o.jsx(x,{span:12,children:o.jsx(T,{title:"Kesilen Fatura",value:23,prefix:o.jsx(p,{})})}),o.jsx(x,{span:12,children:o.jsx(T,{title:"Toplam Tutar",value:125430,prefix:"₺"})})]})]})]})]})}),o.jsxs(Y,{title:"Ürün/Hizmet Seç",visible:G,onCancel:()=>J(!1),footer:null,width:600,children:[o.jsx("div",{className:"product-grid",children:U.map(e=>o.jsx(h,{hoverable:!0,onClick:()=>(e=>{const i={productId:e.id,productName:e.name,description:e.description,quantity:1,unitPrice:e.price,discountPercentage:0,taxRate:18},t=[...a,i];n(t),X(t),J(!1)})(e),className:"product-card",children:o.jsxs(k,{direction:"vertical",style:{width:"100%"},children:[o.jsxs(k,{children:[o.jsx(A,{}),o.jsx(V,{strong:!0,children:e.name})]}),o.jsx(V,{type:"secondary",children:e.description}),o.jsx(V,{type:"success",strong:!0,children:q.formatCurrency(e.price)})]})},e.id))}),o.jsx(v,{}),o.jsx(I,{type:"dashed",icon:o.jsx(N,{}),block:!0,onClick:()=>{F.info("Yeni ürün ekleme özelliği yakında"),J(!1)},children:"Yeni Ürün Ekle"})]})]})};export{$ as default};
