var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;import{j as s}from"./chunk-CpYRwy8c.js";import{r as i}from"./chunk-nBmrMGrr.js";import{M as c,i as l,u,P as a,a as f,b as p,L as h}from"./chunk-BQGPmGfw.js";class d extends i.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=t.offsetParent,n=l(e)&&e.offsetWidth||0,r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft,r.right=n-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function m({children:e,isPresent:t,anchorX:n,root:r}){const o=i.useId(),l=i.useRef(null),u=i.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=i.useContext(c);return i.useInsertionEffect(()=>{const{width:e,height:s,top:i,left:c,right:f}=u.current;if(t||!l.current||!e||!s)return;const p="left"===n?`left: ${c}`:`right: ${f}`;l.current.dataset.motionPopId=o;const h=document.createElement("style");a&&(h.nonce=a);const d=null!=r?r:document.head;return d.appendChild(h),h.sheet&&h.sheet.insertRule(`\n          [data-motion-pop-id="${o}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${s}px !important;\n            ${p}px !important;\n            top: ${i}px !important;\n          }\n        `),()=>{d.contains(h)&&d.removeChild(h)}},[t]),s.jsx(d,{isPresent:t,childRef:l,sizeRef:u,children:i.cloneElement(e,{ref:l})})}const g=({children:e,initial:c,isPresent:l,onExitComplete:f,custom:p,presenceAffectsLayout:h,mode:d,anchorX:g,root:P})=>{const j=u(x),y=i.useId();let E=!0,b=i.useMemo(()=>(E=!1,{id:y,initial:c,isPresent:l,custom:p,onExitComplete:e=>{j.set(e,!0);for(const t of j.values())if(!t)return;f&&f()},register:e=>(j.set(e,!1),()=>j.delete(e))}),[l,j,f]);return h&&E&&(b=((e,s)=>{for(var i in s||(s={}))n.call(s,i)&&o(e,i,s[i]);if(t)for(var i of t(s))r.call(s,i)&&o(e,i,s[i]);return e})({},b)),i.useMemo(()=>{j.forEach((e,t)=>j.set(t,!1))},[l]),i.useEffect(()=>{!l&&!j.size&&f&&f()},[l]),"popLayout"===d&&(e=s.jsx(m,{isPresent:l,anchorX:g,root:P,children:e})),s.jsx(a.Provider,{value:b,children:e})};function x(){return new Map}const P=e=>e.key||"";function j(e){const t=[];return i.Children.forEach(e,e=>{i.isValidElement(e)&&t.push(e)}),t}const y=({children:e,custom:t,initial:n=!0,onExitComplete:r,presenceAffectsLayout:o=!0,mode:c="sync",propagate:l=!1,anchorX:a="left",root:d})=>{const[m,x]=f(l),y=i.useMemo(()=>j(e),[e]),E=l&&!m?[]:y.map(P),b=i.useRef(!0),w=i.useRef(y),v=u(()=>new Map),[C,R]=i.useState(y),[$,I]=i.useState(y);p(()=>{b.current=!1,w.current=y;for(let e=0;e<$.length;e++){const t=P($[e]);E.includes(t)?v.delete(t):!0!==v.get(t)&&v.set(t,!1)}},[$,E.length,E.join("-")]);const L=[];if(y!==C){let e=[...y];for(let t=0;t<$.length;t++){const n=$[t],r=P(n);E.includes(r)||(e.splice(t,0,n),L.push(n))}return"wait"===c&&L.length&&(e=L),I(j(e)),R(y),null}const{forceRender:M}=i.useContext(h);return s.jsx(s.Fragment,{children:$.map(e=>{const i=P(e),u=!(l&&!m)&&(y===$||E.includes(i));return s.jsx(g,{isPresent:u,initial:!(b.current&&!n)&&void 0,custom:t,presenceAffectsLayout:o,mode:c,root:d,onExitComplete:u?void 0:()=>{if(!v.has(i))return;v.set(i,!0);let e=!0;v.forEach(t=>{t||(e=!1)}),e&&(null==M||M(),I(w.current),l&&(null==x||x()),r&&r())},anchorX:a,children:e},i)})})};export{y as A};
