var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,r=(e,t,a)=>new Promise((l,s)=>{var n=e=>{try{r(a.next(e))}catch(t){s(t)}},i=e=>{try{r(a.throw(e))}catch(t){s(t)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(n,i);r((a=a.apply(e,t)).next())});import{ay as c,aD as o,j as d,a2 as u,a3 as p,a5 as m,bi as x,C as h,$ as j,R as g,bd as k,U as y,S as b,b6 as v,I as f,g as Y,c as A,bq as D,bj as w,b1 as S,b7 as I,bz as $,p as z,by as T,Y as C,B as O,Z as P,be as B,T as M,D as N,bc as R,bt as E,bn as F,bF as H,_ as L,aE as q,aV as V}from"./chunk-BxJbIkJM.js";import{r as G}from"./chunk-nBmrMGrr.js";import{a as U}from"./chunk-BsETiAjl.js";import{g as K}from"./chunk-DE96JLJq.js";import{b as Z}from"../index-C9wl3Bba.js";const _=K(),J=e=>r(null,null,function*(){return U.get(`${_}/api/master/subscriptions`,{params:e})}),Q=e=>r(null,null,function*(){return U.post(`${_}/api/master/subscriptions`,e)}),W=(e,t)=>r(null,null,function*(){return U.put(`${_}/api/master/subscriptions/${e}`,t)}),X=(e,t)=>r(null,null,function*(){return U.post(`${_}/api/master/subscriptions/${e}/cancel`,{reason:t})}),ee=(e,t)=>r(null,null,function*(){return U.post(`${_}/api/master/subscriptions/${e}/renew`,{months:t})}),te=(e,t)=>r(null,null,function*(){return U.post(`${_}/api/master/subscriptions/${e}/suspend`,{reason:t})}),ae=e=>r(null,null,function*(){return U.post(`${_}/api/master/subscriptions/${e}/activate`)}),le={getAll:e=>{const t=new URLSearchParams;return(null==e?void 0:e.page)&&t.append("page",e.page.toString()),(null==e?void 0:e.pageSize)&&t.append("pageSize",e.pageSize.toString()),(null==e?void 0:e.status)&&t.append("status",e.status),(null==e?void 0:e.search)&&t.append("search",e.search),(null==e?void 0:e.sortBy)&&t.append("sortBy",e.sortBy),(null==e?void 0:e.sortOrder)&&t.append("sortOrder",e.sortOrder),Z.get(`/api/master/tenants?${t.toString()}`)},getById:e=>Z.get(`/api/master/tenants/${e}`),create:e=>Z.post("/api/master/tenants",e),update:(e,t)=>Z.put(`/api/master/tenants/${e}`,t),delete:e=>Z.delete(`/api/master/tenants/${e}`),toggleStatus:e=>Z.post(`/api/master/tenants/${e}/toggle-status`).then(e=>e).catch(e=>{throw e}),suspend:(e,t)=>Z.post(`/api/master/tenants/${e}/toggle-status`).then(e=>e).catch(e=>{throw e}),activate:e=>Z.post(`/api/master/tenants/${e}/toggle-status`).then(e=>e).catch(e=>{throw e}),resetPassword:e=>Z.post(`/api/master/tenants/${e}/reset-password`),getUsageStats:e=>Z.get(`/api/master/tenants/${e}/statistics`),getActivityLog:e=>Promise.resolve({data:{data:[]}}),loginAsTenant:e=>Promise.resolve({data:{success:!0,data:{tenantId:e,message:"Impersonate feature is not implemented yet. Redirecting to tenant dashboard..."}}})},se={getAll:()=>Z.get("/api/master/packages"),getById:e=>Z.get(`/api/master/packages/${e}`),create:e=>Z.post("/api/master/packages",e),update:(e,t)=>Z.put(`/api/master/packages/${e}`,t),delete:e=>Z.delete(`/api/master/packages/${e}`),duplicate:e=>Z.post(`/api/master/packages/${e}/duplicate`),toggleStatus:(e,t)=>Z.patch(`/api/master/packages/${e}/status`,{isActive:t}),getSubscribers:e=>Z.get(`/api/master/packages/${e}/subscribers`)},{Title:ne,Text:ie}=P,{Option:re}=v,{RangePicker:ce}=I,{TextArea:oe}=f,de=()=>{var e,P;const[U,K]=G.useState(!1),[Z,_]=G.useState([]),[ce,de]=G.useState([]),[ue,pe]=G.useState(!1),[me,xe]=G.useState(null),[he,je]=G.useState(!1),[ge,ke]=G.useState(null),[ye,be]=G.useState([]),[ve,fe]=G.useState([]),[Ye]=c.useForm(),[Ae,De]=G.useState({total:0,active:0,trial:0,suspended:0,revenue:0}),[we,Se]=G.useState("all"),[Ie,$e]=G.useState("");G.useEffect(()=>{ze(),Te(),Ce()},[]),G.useEffect(()=>{Oe(),Pe()},[Z,we,Ie]);const ze=()=>r(null,null,function*(){var e;K(!0);try{const t=yield J();(null==(e=t.data)?void 0:e.success)&&_(t.data.data||[])}catch(t){o.error("Abonelikler yüklenemedi")}finally{K(!1)}}),Te=()=>r(null,null,function*(){var e;try{const t=yield le.getAll();(null==(e=t.data)?void 0:e.data)&&be(t.data.data)}catch(t){}}),Ce=()=>r(null,null,function*(){var e;try{const t=yield se.getAll();(null==(e=t.data)?void 0:e.data)&&fe(t.data.data)}catch(t){}}),Oe=()=>{let e=[...Z];"all"!==we&&(e=e.filter(e=>e.status===we)),Ie&&(e=e.filter(e=>{var t,a;return(null==(t=e.tenantName)?void 0:t.toLowerCase().includes(Ie.toLowerCase()))||(null==(a=e.packageName)?void 0:a.toLowerCase().includes(Ie.toLowerCase()))})),de(e)},Pe=()=>{const e=Z.filter(e=>"Active"===e.status).length,t=Z.filter(e=>"Trial"===e.status).length,a=Z.filter(e=>"Suspended"===e.status).length,l=Z.filter(e=>"Active"===e.status).reduce((e,t)=>{var a;return e+((null==(a=t.price)?void 0:a.amount)||0)},0);De({total:Z.length,active:e,trial:t,suspended:a,revenue:l})},Be=e=>({Active:"success",Trial:"processing",Suspended:"warning",Cancelled:"error",Expired:"default"}[e]||"default"),Me=e=>({Active:d.jsx(j,{}),Trial:d.jsx(g,{}),Suspended:d.jsx(V,{}),Cancelled:d.jsx(q,{}),Expired:d.jsx(g,{})}[e]||null),Ne=[{title:"Tenant",dataIndex:"tenantName",key:"tenantName",render:e=>d.jsx(ie,{strong:!0,children:e})},{title:"Paket",dataIndex:"packageName",key:"packageName",render:e=>d.jsx(C,{color:"blue",children:e})},{title:"Durum",dataIndex:"status",key:"status",render:e=>d.jsx(O,{status:Be(e),text:d.jsxs(b,{children:[Me(e),d.jsx("span",{children:e})]})})},{title:"Fiyat",key:"price",render:(e,t)=>{var a;return d.jsxs(ie,{strong:!0,style:{color:"#52c41a"},children:["₺",(null==(a=t.price)?void 0:a.amount)||0]})}},{title:"Başlangıç",dataIndex:"startDate",key:"startDate",render:e=>y(e).format("DD.MM.YYYY")},{title:"Bitiş",dataIndex:"endDate",key:"endDate",render:e=>{const t=y(e).diff(y(),"day"),a=t<7?"red":t<30?"orange":"green";return d.jsx(M,{title:`${t} gün kaldı`,children:d.jsx(ie,{style:{color:a},children:y(e).format("DD.MM.YYYY")})})}},{title:"Otomatik Yenileme",dataIndex:"autoRenew",key:"autoRenew",render:e=>d.jsx($,{checked:e,disabled:!0,size:"small"})},{title:"İşlemler",key:"actions",fixed:"right",width:120,render:(e,t)=>d.jsx(N,{menu:{items:[{key:"view",label:"Detaylar",icon:d.jsx(E,{}),onClick:()=>(e=>{ke(e),je(!0)})(t)},{key:"edit",label:"Düzenle",icon:d.jsx(F,{}),onClick:()=>(e=>{xe(e),Ye.setFieldsValue({tenantId:e.tenantId,packageId:e.packageId,startDate:y(e.startDate),endDate:y(e.endDate),autoRenew:e.autoRenew}),pe(!0)})(t)},{type:"divider"},..."Active"===t.status?[{key:"suspend",label:"Askıya Al",icon:d.jsx(H,{}),onClick:()=>{return e=t.id,r(null,null,function*(){S.confirm({title:"Aboneliği Askıya Al",content:d.jsx(c,{children:d.jsx(c.Item,{label:"Askıya Alma Nedeni",children:d.jsx(oe,{rows:3,placeholder:"Neden belirtiniz..."})})}),okText:"Askıya Al",cancelText:"Vazgeç",onOk:()=>r(null,null,function*(){try{yield te(e,"Manual suspension"),o.success("Abonelik askıya alındı"),ze()}catch(t){o.error("İşlem başarısız")}})})});var e}}]:[],..."Suspended"===t.status?[{key:"activate",label:"Aktifleştir",icon:d.jsx(L,{}),onClick:()=>{return e=t.id,r(null,null,function*(){try{yield ae(e),o.success("Abonelik aktifleştirildi"),ze()}catch(t){o.error("Aktifleştirme başarısız")}});var e}}]:[],{key:"renew",label:"Yenile",icon:d.jsx(D,{}),onClick:()=>{return e=t.id,r(null,null,function*(){S.confirm({title:"Aboneliği Yenile",content:"Bu aboneliği 1 ay daha yenilemek istiyor musunuz?",okText:"Yenile",cancelText:"Vazgeç",onOk:()=>r(null,null,function*(){try{yield ee(e,1),o.success("Abonelik yenilendi"),ze()}catch(t){o.error("Yenileme başarısız")}})})});var e}},{type:"divider"},{key:"cancel",label:"İptal Et",icon:d.jsx(q,{}),danger:!0,onClick:()=>{return e=t.id,r(null,null,function*(){S.confirm({title:"Aboneliği İptal Et",content:"Bu aboneliği iptal etmek istediğinizden emin misiniz?",okText:"İptal Et",cancelText:"Vazgeç",onOk:()=>r(null,null,function*(){try{yield X(e),o.success("Abonelik iptal edildi"),ze()}catch(t){o.error("İptal işlemi başarısız")}})})});var e}}]},trigger:["click"],children:d.jsx(A,{type:"text",icon:d.jsx(R,{})})})}];return d.jsxs("div",{className:"master-subscriptions-page",children:[d.jsxs(u,{gutter:[16,16],style:{marginBottom:24},children:[d.jsx(p,{xs:24,sm:12,md:6,children:d.jsx(m,{children:d.jsx(x,{title:"Toplam Abonelik",value:Ae.total,prefix:d.jsx(h,{})})})}),d.jsx(p,{xs:24,sm:12,md:6,children:d.jsx(m,{children:d.jsx(x,{title:"Aktif",value:Ae.active,prefix:d.jsx(j,{}),valueStyle:{color:"#52c41a"}})})}),d.jsx(p,{xs:24,sm:12,md:6,children:d.jsx(m,{children:d.jsx(x,{title:"Deneme",value:Ae.trial,prefix:d.jsx(g,{}),valueStyle:{color:"#1890ff"}})})}),d.jsx(p,{xs:24,sm:12,md:6,children:d.jsx(m,{children:d.jsx(x,{title:"Aylık Gelir",value:Ae.revenue,prefix:"₺",valueStyle:{color:"#faad14"}})})})]}),d.jsx(m,{title:"Abonelik Yönetimi",extra:d.jsxs(b,{children:[d.jsxs(v,{value:we,onChange:Se,style:{width:150},children:[d.jsx(re,{value:"all",children:"Tüm Durumlar"}),d.jsx(re,{value:"Active",children:"Aktif"}),d.jsx(re,{value:"Trial",children:"Deneme"}),d.jsx(re,{value:"Suspended",children:"Askıda"}),d.jsx(re,{value:"Cancelled",children:"İptal"})]}),d.jsx(f,{placeholder:"Ara...",prefix:d.jsx(Y,{}),value:Ie,onChange:e=>$e(e.target.value),style:{width:200}}),d.jsx(A,{icon:d.jsx(D,{}),onClick:ze,children:"Yenile"}),d.jsx(A,{type:"primary",icon:d.jsx(w,{}),onClick:()=>{Ye.resetFields(),xe(null),pe(!0)},children:"Yeni Abonelik"})]}),children:d.jsx(k,{columns:Ne,dataSource:ce,rowKey:"id",loading:U,scroll:{x:1200},pagination:{showSizeChanger:!0,showTotal:e=>`Toplam ${e} abonelik`}})}),d.jsx(S,{title:me?"Abonelik Düzenle":"Yeni Abonelik",open:ue,onCancel:()=>pe(!1),footer:null,width:600,children:d.jsxs(c,{form:Ye,layout:"vertical",onFinish:e=>r(null,null,function*(){var r,c,d,u;try{const p=(d=((e,t)=>{for(var a in t||(t={}))s.call(t,a)&&i(e,a,t[a]);if(l)for(var a of l(t))n.call(t,a)&&i(e,a,t[a]);return e})({},e),u={startDate:null==(r=e.startDate)?void 0:r.format("YYYY-MM-DD"),endDate:null==(c=e.endDate)?void 0:c.format("YYYY-MM-DD")},t(d,a(u)));me?(yield W(me.id,p),o.success("Abonelik güncellendi")):(yield Q(p),o.success("Abonelik oluşturuldu")),pe(!1),ze()}catch(p){o.error("İşlem başarısız")}}),children:[d.jsxs(u,{gutter:16,children:[d.jsx(p,{span:12,children:d.jsx(c.Item,{name:"tenantId",label:"Tenant",rules:[{required:!0,message:"Tenant seçiniz"}],children:d.jsx(v,{showSearch:!0,placeholder:"Tenant seçiniz",optionFilterProp:"children",children:ye.map(e=>d.jsx(re,{value:e.id,children:e.name},e.id))})})}),d.jsx(p,{span:12,children:d.jsx(c.Item,{name:"packageId",label:"Paket",rules:[{required:!0,message:"Paket seçiniz"}],children:d.jsx(v,{placeholder:"Paket seçiniz",children:ve.map(e=>d.jsxs(re,{value:e.id,children:[e.name," - ₺",e.price]},e.id))})})})]}),d.jsxs(u,{gutter:16,children:[d.jsx(p,{span:12,children:d.jsx(c.Item,{name:"startDate",label:"Başlangıç Tarihi",rules:[{required:!0,message:"Başlangıç tarihi seçiniz"}],children:d.jsx(I,{style:{width:"100%"}})})}),d.jsx(p,{span:12,children:d.jsx(c.Item,{name:"endDate",label:"Bitiş Tarihi",rules:[{required:!0,message:"Bitiş tarihi seçiniz"}],children:d.jsx(I,{style:{width:"100%"}})})})]}),d.jsx(c.Item,{name:"autoRenew",label:"Otomatik Yenileme",valuePropName:"checked",children:d.jsx($,{})}),d.jsx(c.Item,{children:d.jsxs(b,{style:{width:"100%",justifyContent:"flex-end"},children:[d.jsx(A,{onClick:()=>pe(!1),children:"İptal"}),d.jsx(A,{type:"primary",htmlType:"submit",children:me?"Güncelle":"Oluştur"})]})})]})}),d.jsx(z,{title:"Abonelik Detayları",placement:"right",width:600,onClose:()=>je(!1),open:he,children:ge&&d.jsxs(d.Fragment,{children:[d.jsxs(T,{bordered:!0,column:1,style:{marginBottom:24},children:[d.jsx(T.Item,{label:"Tenant",children:ge.tenantName}),d.jsx(T.Item,{label:"Paket",children:d.jsx(C,{color:"blue",children:ge.packageName})}),d.jsx(T.Item,{label:"Durum",children:d.jsx(O,{status:Be(ge.status),text:ge.status})}),d.jsxs(T.Item,{label:"Fiyat",children:["₺",(null==(e=ge.price)?void 0:e.amount)||0]}),d.jsx(T.Item,{label:"Başlangıç",children:y(ge.startDate).format("DD.MM.YYYY")}),d.jsx(T.Item,{label:"Bitiş",children:y(ge.endDate).format("DD.MM.YYYY")}),d.jsx(T.Item,{label:"Otomatik Yenileme",children:d.jsx($,{checked:ge.autoRenew,disabled:!0})})]}),d.jsx(ne,{level:5,children:"Özellikler"}),d.jsx(b,{wrap:!0,style:{marginBottom:24},children:null==(P=ge.features)?void 0:P.map(e=>d.jsx(C,{icon:d.jsx(j,{}),color:"success",children:e},e))}),d.jsx(ne,{level:5,children:"İşlem Geçmişi"}),d.jsxs(B,{children:[d.jsxs(B.Item,{color:"green",children:["Abonelik oluşturuldu - ",y(ge.createdAt).format("DD.MM.YYYY HH:mm")]}),d.jsxs(B.Item,{color:"blue",children:["Paket güncellendi - ",y().subtract(15,"day").format("DD.MM.YYYY HH:mm")]}),d.jsxs(B.Item,{color:"gray",children:["Otomatik yenileme aktifleştirildi - ",y().subtract(30,"day").format("DD.MM.YYYY HH:mm")]})]})]})})]})};export{de as MasterSubscriptionsPage,de as default};
