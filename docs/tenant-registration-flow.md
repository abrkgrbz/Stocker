# Tenant KayÄ±t ve ModÃ¼l Aktivasyon AkÄ±ÅŸÄ±

Bu dokÃ¼mantasyon, kullanÄ±cÄ±nÄ±n kayÄ±t olmasÄ±ndan modÃ¼llerin aktif edilmesine kadar olan tÃ¼m sÃ¼reci aÃ§Ä±klamaktadÄ±r.

## Genel BakÄ±ÅŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TENANT KAYIT AKIÅI                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1. KAYIT FORMU  â†’  2. E-POSTA DOÄRULAMA  â†’  3. TENANT OLUÅTURMA           â”‚
â”‚   (PackageId      (Senkron Migration +     (SignalR ile ilerleme)          â”‚
â”‚    alÄ±nÄ±r)         TenantDomain oluÅŸur)                                    â”‚
â”‚                                                                             â”‚
â”‚  4. GÄ°RÄ°Å  â†’  5. SETUP WIZARD  â†’  6. PAKET SEÃ‡Ä°MÄ°  â†’  7. MODÃœL AKTÄ°VASYON â”‚
â”‚                                   (Subscription                             â”‚
â”‚                                    burada oluÅŸur)                           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ Ã–NEMLÄ° NOTLAR (Kod-DokÃ¼man EÅŸleÅŸmesi)

### 1. PackageId Durumu
- **KayÄ±t formunda** `PackageId` **zorunlu alan** olarak istenir (`RegisterTenantCommand.cs:28`)
- **ANCAK** bu deÄŸer `CreateTenantFromRegistrationCommandHandler` tarafÄ±ndan **KULLANILMAZ**
- Subscription oluÅŸturma iÅŸlemi tamamen **Setup Wizard** aÅŸamasÄ±na bÄ±rakÄ±lmÄ±ÅŸtÄ±r
- **Ã–neri**: KayÄ±t formundan `PackageId` kaldÄ±rÄ±labilir veya opsiyonel yapÄ±labilir

### 2. Migration ZamanlamasÄ±
- Migrations **E-POSTA DOÄRULAMA** sÄ±rasÄ±nda **SENKRON** olarak Ã§alÄ±ÅŸÄ±r (`VerifyEmailCommandHandler.cs:198`)
- SignalR akÄ±ÅŸÄ± (`CreateTenantFromRegistration`) **Ä°KÄ°NCÄ° BÄ°R MÄ°GRATION** Ã§alÄ±ÅŸtÄ±rÄ±r
- Bu durum, bazÄ± tenantlar iÃ§in migration'larÄ±n iki kez Ã§alÄ±ÅŸmasÄ±na yol aÃ§abilir

---

## DetaylÄ± AkÄ±ÅŸ DiyagramÄ±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                              1. KAYIT FORMU                                          â”‚
â”‚                         /register sayfasÄ± (Frontend)                                 â”‚
â”‚                                                                                      â”‚
â”‚   KullanÄ±cÄ± Bilgileri:                                                              â”‚
â”‚   â€¢ Åirket AdÄ± (CompanyName)                                                        â”‚
â”‚   â€¢ Åirket Kodu (CompanyCode) â†’ subdomain olarak kullanÄ±lÄ±r                         â”‚
â”‚   â€¢ E-posta (ContactEmail)                                                          â”‚
â”‚   â€¢ Åifre (Password)                                                                â”‚
â”‚   â€¢ Telefon (ContactPhone - Opsiyonel)                                              â”‚
â”‚   â€¢ PackageId âš ï¸ (Zorunlu alan AMA kullanÄ±lmÄ±yor - bkz. Ã¶nemli notlar)             â”‚
â”‚   â€¢ BillingPeriod (Monthly/Yearly)                                                  â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                    POST /api/public/tenant-registration/register                     â”‚
â”‚                                                                                      â”‚
â”‚   RegisterTenantCommand â†’ RegisterTenantCommandHandler                              â”‚
â”‚                                                                                      â”‚
â”‚   Ä°ÅŸlemler:                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚ 1. E-posta benzersizlik kontrolÃ¼                                     â”‚           â”‚
â”‚   â”‚ 2. CompanyCode benzersizlik kontrolÃ¼ (subdomain iÃ§in)               â”‚           â”‚
â”‚   â”‚ 3. TenantRegistration kaydÄ± oluÅŸtur (Status: PendingVerification)   â”‚           â”‚
â”‚   â”‚ 4. AdminPasswordHash'i kaydet (daha sonra MasterUser iÃ§in)          â”‚           â”‚
â”‚   â”‚ 5. 6 haneli doÄŸrulama kodu Ã¼ret                                      â”‚           â”‚
â”‚   â”‚ 6. DoÄŸrulama e-postasÄ± gÃ¶nder                                        â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚ âš ï¸ PackageId alÄ±nÄ±r ama bu aÅŸamada iÅŸlenmez!                        â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   VeritabanÄ±: MasterDb.TenantRegistrations                                          â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                          2. E-POSTA DOÄRULAMA                                        â”‚
â”‚                   /verify-email?email=...&token=... (Frontend)                       â”‚
â”‚                                                                                      â”‚
â”‚   KullanÄ±cÄ± e-postasÄ±ndaki linke tÄ±klar veya kodu girer                             â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                   POST /api/identity/verify-email                                    â”‚
â”‚                                                                                      â”‚
â”‚   VerifyEmailCommand â†’ VerifyEmailCommandHandler                                    â”‚
â”‚                                                                                      â”‚
â”‚   âš¡ KRITIK: Bu handler SENKRON olarak veritabanÄ± oluÅŸturur!                        â”‚
â”‚                                                                                      â”‚
â”‚   Ä°ÅŸlemler:                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚ 1. Token doÄŸrulama                                                   â”‚           â”‚
â”‚   â”‚ 2. user.VerifyEmail() - Email doÄŸrulandÄ± olarak iÅŸaretle            â”‚           â”‚
â”‚   â”‚ 3. user.Activate() - KullanÄ±cÄ±yÄ± aktif et                           â”‚           â”‚
â”‚   â”‚ 4. Tenant'Ä± bul (ContactEmail'e gÃ¶re)                               â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚ 5. TenantRegistration kaydÄ± oluÅŸtur                                  â”‚           â”‚
â”‚   â”‚    â””â”€ registration.Approve("System", tenant.Id)                     â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚ 6. â­ TenantDomain kaydÄ± oluÅŸtur (Subdomain)                        â”‚           â”‚
â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚           â”‚
â”‚   â”‚    â”‚ TenantDomain.Create(                                      â”‚     â”‚           â”‚
â”‚   â”‚    â”‚   tenantId: tenant.Id,                                    â”‚     â”‚           â”‚
â”‚   â”‚    â”‚   domainName: "{tenant.Code}.stoocker.app",              â”‚     â”‚           â”‚
â”‚   â”‚    â”‚   isPrimary: true)                                        â”‚     â”‚           â”‚
â”‚   â”‚    â”‚                                                           â”‚     â”‚           â”‚
â”‚   â”‚    â”‚ tenantDomain.Verify() // Otomatik doÄŸrula                 â”‚     â”‚           â”‚
â”‚   â”‚    â”‚ â†’ MasterDb.TenantDomains tablosuna kaydet                 â”‚     â”‚           â”‚
â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚ 7. ğŸ”„ SENKRON Migration (VerifyEmailCommandHandler:198)             â”‚           â”‚
â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚           â”‚
â”‚   â”‚    â”‚ await _migrationService.MigrateTenantDatabaseAsync(      â”‚     â”‚           â”‚
â”‚   â”‚    â”‚     tenant.Id);                                           â”‚     â”‚           â”‚
â”‚   â”‚    â”‚                                                           â”‚     â”‚           â”‚
â”‚   â”‚    â”‚ Bu iÅŸlem BEKLER - kullanÄ±cÄ± bu sÃ¼re boyunca bekler       â”‚     â”‚           â”‚
â”‚   â”‚    â”‚ Hata olursa kullanÄ±cÄ±ya hata mesajÄ± gÃ¶sterilir           â”‚     â”‚           â”‚
â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚ 8. Tenant data seeding'i arka plan job olarak kuyruÄŸa al           â”‚           â”‚
â”‚   â”‚    â””â”€ _backgroundJobService.Enqueue<ITenantProvisioningJob>        â”‚           â”‚
â”‚   â”‚       (job => job.SeedTenantDataAsync(tenant.Id))                  â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   Return:                                                                            â”‚
â”‚   {                                                                                  â”‚
â”‚     success: true,                                                                   â”‚
â”‚     message: "Email adresiniz baÅŸarÄ±yla doÄŸrulandÄ±!",                              â”‚
â”‚     redirectUrl: "/login",                                                          â”‚
â”‚     tenantId: Guid,                                                                 â”‚
â”‚     tenantName: string                                                              â”‚
â”‚   }                                                                                  â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                          3. TENANT OLUÅTURMA                                         â”‚
â”‚                    CreateTenantFromRegistrationCommandHandler                        â”‚
â”‚                                                                                      â”‚
â”‚   âš¡ SignalR ile gerÃ§ek zamanlÄ± ilerleme bildirimi                                   â”‚
â”‚   âš ï¸ NOT: Email doÄŸrulama sÄ±rasÄ±nda migration Ã§alÄ±ÅŸtÄ±ysa, bu handler tekrar Ã§alÄ±ÅŸÄ±râ”‚
â”‚                                                                                      â”‚
â”‚   AdÄ±mlar (TenantCreationStep enum):                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚           â”‚
â”‚   â”‚  â”‚ 1. Starting  â”‚ â”€â”€â–¶ â”‚ 2. Creating  â”‚ â”€â”€â–¶ â”‚ 3. Creating  â”‚        â”‚           â”‚
â”‚   â”‚  â”‚              â”‚     â”‚    Tenant    â”‚     â”‚  MasterUser  â”‚        â”‚           â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚           â”‚
â”‚   â”‚         â”‚                    â”‚                    â”‚                 â”‚           â”‚
â”‚   â”‚         â–¼                    â–¼                    â–¼                 â”‚           â”‚
â”‚   â”‚  SignalR: 5%          SignalR: 10%         SignalR: 30%            â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚           â”‚
â”‚   â”‚  â”‚ 4. Creating  â”‚ â”€â”€â–¶ â”‚ 5. Running   â”‚ â”€â”€â–¶ â”‚ 6. Seeding   â”‚        â”‚           â”‚
â”‚   â”‚  â”‚   Database   â”‚     â”‚  Migrations  â”‚     â”‚    Data      â”‚        â”‚           â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚           â”‚
â”‚   â”‚         â”‚                    â”‚                    â”‚                 â”‚           â”‚
â”‚   â”‚         â–¼                    â–¼                    â–¼                 â”‚           â”‚
â”‚   â”‚  SignalR: 40%         SignalR: 50%         SignalR: 60%            â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚           â”‚
â”‚   â”‚  â”‚ 7. Activatingâ”‚ â”€â”€â–¶ â”‚ 8. Sending   â”‚ â”€â”€â–¶ â”‚ 9. Completed â”‚        â”‚           â”‚
â”‚   â”‚  â”‚    Tenant    â”‚     â”‚ WelcomeEmail â”‚     â”‚              â”‚        â”‚           â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚           â”‚
â”‚   â”‚         â”‚                    â”‚                    â”‚                 â”‚           â”‚
â”‚   â”‚         â–¼                    â–¼                    â–¼                 â”‚           â”‚
â”‚   â”‚  SignalR: 85%         SignalR: 95%         SignalR: 100%           â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   âš ï¸ NOT: Bu aÅŸamada Subscription OLUÅTURULMAZ!                                     â”‚
â”‚   Subscription, Setup Wizard'da paket seÃ§ildikten sonra oluÅŸturulur.                â”‚
â”‚                                                                                      â”‚
â”‚   OluÅŸturulan KayÄ±tlar:                                                             â”‚
â”‚   â€¢ MasterDb.Tenants (Status: Active)                                               â”‚
â”‚   â€¢ MasterDb.MasterUsers (tenant admin kullanÄ±cÄ±sÄ±)                                 â”‚
â”‚   â€¢ MasterDb.TenantDomains ({code}.stocker.app)                                     â”‚
â”‚   â€¢ TenantDb_[TenantId] (yeni PostgreSQL veritabanÄ±)                               â”‚
â”‚   â€¢ TenantDb.TenantUsers (ilk kullanÄ±cÄ±)                                           â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                     Frontend: TenantCreationProgress.tsx                             â”‚
â”‚                                                                                      â”‚
â”‚   SignalR Ã¼zerinden ilerleme takibi:                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚  âœ“ BaÅŸlatÄ±lÄ±yor                    [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 60%      â”‚           â”‚
â”‚   â”‚  âœ“ Åirket kaydÄ± oluÅŸturuluyor                                       â”‚           â”‚
â”‚   â”‚  âœ“ KullanÄ±cÄ± hesabÄ± oluÅŸturuluyor                                   â”‚           â”‚
â”‚   â”‚  â— VeritabanÄ± oluÅŸturuluyor        â† Åu anki adÄ±m                   â”‚           â”‚
â”‚   â”‚  â—‹ VeritabanÄ± yapÄ±landÄ±rÄ±lÄ±yor                                      â”‚           â”‚
â”‚   â”‚  â—‹ Ä°lk veriler yÃ¼kleniyor                                           â”‚           â”‚
â”‚   â”‚  â—‹ HesabÄ±nÄ±z aktifleÅŸtiriliyor                                      â”‚           â”‚
â”‚   â”‚  â—‹ HoÅŸgeldin e-postasÄ± gÃ¶nderiliyor                                 â”‚           â”‚
â”‚   â”‚  â—‹ TamamlandÄ±                                                        â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   TamamlandÄ±ÄŸÄ±nda â†’ /login?message=tenant-created sayfasÄ±na yÃ¶nlendir              â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                              4. GÄ°RÄ°Å                                                â”‚
â”‚                           /login (Frontend)                                          â”‚
â”‚                                                                                      â”‚
â”‚   POST /api/auth/login                                                              â”‚
â”‚                                                                                      â”‚
â”‚   Ä°ÅŸlemler:                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚ 1. KullanÄ±cÄ± kimlik doÄŸrulama                                        â”‚           â”‚
â”‚   â”‚ 2. JWT token Ã¼ret (tenantId claim dahil)                            â”‚           â”‚
â”‚   â”‚ 3. Tenant.SetupCompleted kontrolÃ¼                                    â”‚           â”‚
â”‚   â”‚    â€¢ false ise â†’ /setup-wizard'a yÃ¶nlendir                          â”‚           â”‚
â”‚   â”‚    â€¢ true ise â†’ /dashboard'a yÃ¶nlendir                              â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                           5. SETUP WIZARD                                            â”‚
â”‚                      /setup-wizard (Frontend)                                        â”‚
â”‚                                                                                      â”‚
â”‚   AdÄ±mlar:                                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚           â”‚
â”‚   â”‚  â”‚   AdÄ±m 1    â”‚ â”€â–¶ â”‚   AdÄ±m 2    â”‚ â”€â–¶ â”‚   AdÄ±m 3    â”‚             â”‚           â”‚
â”‚   â”‚  â”‚  ÅÄ°RKET     â”‚    â”‚   PAKET     â”‚    â”‚   Ã–ZET      â”‚             â”‚           â”‚
â”‚   â”‚  â”‚  BÄ°LGÄ°LERÄ°  â”‚    â”‚   SEÃ‡Ä°MÄ°    â”‚    â”‚   & ONAY    â”‚             â”‚           â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   AdÄ±m 1 - Åirket Bilgileri:                                                        â”‚
â”‚   â€¢ Åirket adÄ±, vergi no, adres vb.                                                 â”‚
â”‚                                                                                      â”‚
â”‚   AdÄ±m 2 - Paket SeÃ§imi:                                                            â”‚
â”‚   â€¢ BaÅŸlangÄ±Ã§, Profesyonel, Kurumsal paketler                                       â”‚
â”‚   â€¢ Her paketin iÃ§erdiÄŸi modÃ¼ller gÃ¶rÃ¼ntÃ¼lenir                                      â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                      6. PAKET SEÃ‡Ä°MÄ° & KURULUM TAMAMLAMA                            â”‚
â”‚                                                                                      â”‚
â”‚                    POST /api/setup/complete-setup                                    â”‚
â”‚                                                                                      â”‚
â”‚   CompleteSetupCommand â†’ CompleteSetupCommandHandler                                â”‚
â”‚                                                                                      â”‚
â”‚   Request Body:                                                                      â”‚
â”‚   {                                                                                  â”‚
â”‚     "tenantId": "guid",                                                             â”‚
â”‚     "packageId": "guid",           // â­ ASIL PAKET SEÃ‡Ä°MÄ° BURADA                  â”‚
â”‚     "selectedModules": ["CRM", "Sales", "Inventory"],  // ModÃ¼l kodlarÄ±            â”‚
â”‚     "companyDetails": { ... }      // Åirket bilgileri                              â”‚
â”‚   }                                                                                  â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                    7. MODÃœL AKTÄ°VASYON SÃœRECÄ°                                        â”‚
â”‚                    CompleteSetupCommandHandler                                       â”‚
â”‚                                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  1. Subscription OluÅŸturma                                           â”‚           â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚           â”‚
â”‚   â”‚  â”‚ â€¢ Subscription.Create(tenantId, packageId, price, ...)    â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ â€¢ Status: Deneme (14 gÃ¼nlÃ¼k trial)                         â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ â€¢ MasterDb.Subscriptions tablosuna kaydet                  â”‚     â”‚           â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚           â”‚
â”‚   â”‚                          â”‚                                           â”‚           â”‚
â”‚   â”‚                          â–¼                                           â”‚           â”‚
â”‚   â”‚  2. ModÃ¼lleri Subscription'a Ekle                                    â”‚           â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚           â”‚
â”‚   â”‚  â”‚ foreach (module in selectedModules)                        â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ {                                                          â”‚     â”‚           â”‚
â”‚   â”‚  â”‚     subscription.AddModule(moduleCode, moduleName, max);   â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ }                                                          â”‚     â”‚           â”‚
â”‚   â”‚  â”‚                                                            â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ â†’ MasterDb.SubscriptionModules tablosuna kaydet            â”‚     â”‚           â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚           â”‚
â”‚   â”‚                          â”‚                                           â”‚           â”‚
â”‚   â”‚                          â–¼                                           â”‚           â”‚
â”‚   â”‚  3. ModÃ¼l Migration'larÄ±nÄ± Ã‡alÄ±ÅŸtÄ±r                                  â”‚           â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚           â”‚
â”‚   â”‚  â”‚ MigrationService.ApplyModuleMigrationsAsync()              â”‚     â”‚           â”‚
â”‚   â”‚  â”‚                                                            â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ Her modÃ¼l iÃ§in:                                            â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ â€¢ CRM â†’ CRMDbContext migrations                            â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ â€¢ Sales â†’ SalesDbContext migrations                        â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ â€¢ Inventory â†’ InventoryDbContext migrations                â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ â€¢ HR â†’ HRDbContext migrations                              â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ â€¢ Finance â†’ FinanceDbContext migrations                    â”‚     â”‚           â”‚
â”‚   â”‚  â”‚                                                            â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ â†’ Tenant veritabanÄ±nda modÃ¼l tablolarÄ±nÄ± oluÅŸtur           â”‚     â”‚           â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚           â”‚
â”‚   â”‚                          â”‚                                           â”‚           â”‚
â”‚   â”‚                          â–¼                                           â”‚           â”‚
â”‚   â”‚  4. Tenant'Ä± GÃ¼ncelle                                                â”‚           â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚           â”‚
â”‚   â”‚  â”‚ tenant.CompleteSetup();                                    â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ // SetupCompleted = true                                   â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ // SetupCompletedAt = DateTime.UtcNow                      â”‚     â”‚           â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                         8. MODÃœL KULLANIMI                                           â”‚
â”‚                                                                                      â”‚
â”‚   Frontend modÃ¼l kontrolÃ¼:                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  GET /api/tenant/user-modules/active                                 â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  UserModulesController.GetActiveModules()                           â”‚           â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚           â”‚
â”‚   â”‚  â”‚ 1. Tenant'Ä±n aktif Subscription'Ä±nÄ± bul                    â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ 2. subscription.Modules'dan modÃ¼lleri al                   â”‚     â”‚           â”‚
â”‚   â”‚  â”‚    (SubscriptionModules tablosu - birincil kaynak)         â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ 3. Fallback: PackageModules (SubscriptionModules yoksa)    â”‚     â”‚           â”‚
â”‚   â”‚  â”‚ 4. ModuleInfo listesi dÃ¶ndÃ¼r                               â”‚     â”‚           â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  Response:                                                           â”‚           â”‚
â”‚   â”‚  {                                                                   â”‚           â”‚
â”‚   â”‚    "tenantId": "guid",                                              â”‚           â”‚
â”‚   â”‚    "modules": [                                                      â”‚           â”‚
â”‚   â”‚      { "code": "crm", "name": "CRM", "isActive": true },            â”‚           â”‚
â”‚   â”‚      { "code": "sales", "name": "SatÄ±ÅŸ", "isActive": true },        â”‚           â”‚
â”‚   â”‚      { "code": "inventory", "name": "Stok", "isActive": true }      â”‚           â”‚
â”‚   â”‚    ],                                                                â”‚           â”‚
â”‚   â”‚    "packageName": "Profesyonel",                                    â”‚           â”‚
â”‚   â”‚    "subscriptionStatus": "Deneme"                                   â”‚           â”‚
â”‚   â”‚  }                                                                   â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   Sidebar menÃ¼ (Frontend):                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚  const { data } = useActiveModules();                               â”‚           â”‚
â”‚   â”‚  const hasModule = (code) => data?.modules?.some(m => m.code === code);        â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  {hasModule('crm') && <CRMMenuItem />}                              â”‚           â”‚
â”‚   â”‚  {hasModule('sales') && <SalesMenuItem />}                          â”‚           â”‚
â”‚   â”‚  {hasModule('inventory') && <InventoryMenuItem />}                  â”‚           â”‚
â”‚   â”‚  {hasModule('hr') && <HRMenuItem />}                                â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Orphaned Tenant Temizlik MekanizmasÄ±

Tenant oluÅŸturma iÅŸlemi baÅŸarÄ±sÄ±z olduÄŸunda (Ã¶rn. migration hatasÄ±), sisteme "orphaned" (yetim) kayÄ±tlar kalabilir. Bu durum `CreateTenantFromRegistrationCommandHandler` iÃ§inde otomatik olarak ele alÄ±nÄ±r:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                    ORPHANED TENANT TEMÄ°ZLÄ°K MEKANÄ°ZMASI                             â”‚
â”‚                                                                                      â”‚
â”‚   Tetiklenme KoÅŸulu:                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚ registration.TenantId.HasValue && registration.TenantId != Empty    â”‚           â”‚
â”‚   â”‚ (Yani daha Ã¶nce bir tenant oluÅŸturma denemesi yapÄ±lmÄ±ÅŸ)            â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   Kontrol AdÄ±mlarÄ±:                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚ 1. Mevcut tenant'Ä± bul                                               â”‚           â”‚
â”‚   â”‚ 2. Tenant veritabanÄ±na baÄŸlanmayÄ± dene                              â”‚           â”‚
â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚           â”‚
â”‚   â”‚    â”‚ using var ctx = await _tenantDbContextFactory.CreateAsync()â”‚   â”‚           â”‚
â”‚   â”‚    â”‚ tenantDbIsValid = await dbContext.Database.CanConnectAsync()â”‚  â”‚           â”‚
â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚ 3. EÄŸer baÄŸlantÄ± BAÅARILI ve tenant AKTÄ°F ise:                      â”‚           â”‚
â”‚   â”‚    â†’ Mevcut tenant'Ä± dÃ¶ndÃ¼r (yeniden oluÅŸturmaya gerek yok)        â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚ 4. EÄŸer baÄŸlantÄ± BAÅARISIZ veya tenant Ä°NAKTÄ°F ise:                â”‚           â”‚
â”‚   â”‚    â†’ Temizlik sÃ¼recini baÅŸlat                                       â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   Temizlik AdÄ±mlarÄ±:                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚ 1. Orphaned Subscription'Ä± sil                                       â”‚           â”‚
â”‚   â”‚    â””â”€ _context.Subscriptions.Remove(orphanedSubscription)           â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚ 2. Orphaned MasterUser'Ä± sil                                         â”‚           â”‚
â”‚   â”‚    â””â”€ _context.MasterUsers.Remove(orphanedUser)                     â”‚           â”‚
â”‚   â”‚       (admin email'e gÃ¶re eÅŸleÅŸtirme)                               â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚ 3. Orphaned Tenant'Ä± sil                                             â”‚           â”‚
â”‚   â”‚    â””â”€ _context.Tenants.Remove(existingTenant)                       â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚ 4. Registration'Ä±n tenant referansÄ±nÄ± temizle                        â”‚           â”‚
â”‚   â”‚    â””â”€ registration.ClearTenantId()                                  â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚ 5. DeÄŸiÅŸiklikleri kaydet                                             â”‚           â”‚
â”‚   â”‚    â””â”€ await _unitOfWork.SaveChangesAsync()                          â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚ 6. (Best-effort) Orphaned veritabanÄ±nÄ± sil                          â”‚           â”‚
â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚           â”‚
â”‚   â”‚    â”‚ a) Aktif baÄŸlantÄ±larÄ± sonlandÄ±r:                           â”‚   â”‚           â”‚
â”‚   â”‚    â”‚    SELECT pg_terminate_backend(pid) FROM pg_stat_activity  â”‚   â”‚           â”‚
â”‚   â”‚    â”‚    WHERE datname = '{orphanedDbName}'                      â”‚   â”‚           â”‚
â”‚   â”‚    â”‚                                                            â”‚   â”‚           â”‚
â”‚   â”‚    â”‚ b) VeritabanÄ±nÄ± sil:                                       â”‚   â”‚           â”‚
â”‚   â”‚    â”‚    DROP DATABASE IF EXISTS "{orphanedDbName}"              â”‚   â”‚           â”‚
â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚ 7. Yeni tenant oluÅŸturma sÃ¼recine devam et                          â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   Hata Durumu:                                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚ Temizlik baÅŸarÄ±sÄ±z olursa:                                          â”‚           â”‚
â”‚   â”‚ â†’ Error: "Tenant.CleanupFailed"                                     â”‚           â”‚
â”‚   â”‚ â†’ Mesaj: "Ã–nceki baÅŸarÄ±sÄ±z tenant oluÅŸturma iÅŸlemi temizlenemedi.  â”‚           â”‚
â”‚   â”‚          LÃ¼tfen destek ile iletiÅŸime geÃ§in."                        â”‚           â”‚
â”‚   â”‚ â†’ Manuel mÃ¼dahale gerekebilir                                       â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## TenantDomain (Subdomain) OluÅŸturma DetaylarÄ±

Her tenant iÃ§in benzersiz bir subdomain oluÅŸturulur. Bu iÅŸlem iki noktada gerÃ§ekleÅŸir:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                       TENANTDOMAIN OLUÅTURMA SÃœRECÄ°                                 â”‚
â”‚                                                                                      â”‚
â”‚   1. KAYNAK: VerifyEmailCommandHandler (SatÄ±r 176-184)                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  // TenantDomain kaydÄ± oluÅŸtur                                      â”‚           â”‚
â”‚   â”‚  var tenantDomain = TenantDomain.Create(                            â”‚           â”‚
â”‚   â”‚      tenantId: tenant.Id,                                           â”‚           â”‚
â”‚   â”‚      domainName: $"{tenant.Code}.stoocker.app",  // Ã–rn: abc.stoocker.app     â”‚
â”‚   â”‚      isPrimary: true);                                              â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  tenantDomain.Verify();  // Otomatik doÄŸrula (manuel DNS gerekmez) â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  await _unitOfWork.Repository<TenantDomain>()                       â”‚           â”‚
â”‚   â”‚      .AddAsync(tenantDomain, cancellationToken);                    â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   2. KAYNAK: CreateTenantFromRegistrationCommandHandler (SatÄ±r 250-251)            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  // Domain ekle (tenant entity Ã¼zerinden)                           â”‚           â”‚
â”‚   â”‚  var domainName = $"{registration.CompanyCode.ToLower()}.stocker.app";        â”‚
â”‚   â”‚  tenant.AddDomain(domainName, isPrimary: true);                     â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   VeritabanÄ± ÅemasÄ± (MasterDb.TenantDomains):                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚  TenantDomains                                                       â”‚           â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚           â”‚
â”‚   â”‚  â”‚ Id (PK, Guid)          â”‚                                         â”‚           â”‚
â”‚   â”‚  â”‚ TenantId (FK)          â”‚ â†’ Tenants.Id                            â”‚           â”‚
â”‚   â”‚  â”‚ DomainName (unique)    â”‚ â†’ "abc-company.stoocker.app"           â”‚           â”‚
â”‚   â”‚  â”‚ IsPrimary (bool)       â”‚ â†’ true (varsayÄ±lan subdomain)          â”‚           â”‚
â”‚   â”‚  â”‚ IsVerified (bool)      â”‚ â†’ true (otomatik doÄŸrulanÄ±r)           â”‚           â”‚
â”‚   â”‚  â”‚ VerifiedAt (DateTime?) â”‚ â†’ DoÄŸrulama tarihi                      â”‚           â”‚
â”‚   â”‚  â”‚ CreatedAt (DateTime)   â”‚                                         â”‚           â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   Domain Format KurallarÄ±:                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚  â€¢ CompanyCode kÃ¼Ã§Ã¼k harfe Ã§evrilir                                 â”‚           â”‚
â”‚   â”‚  â€¢ Format: {company_code}.stoocker.app                              â”‚           â”‚
â”‚   â”‚  â€¢ Ã–rnek: "ABC-Tech" â†’ "abc-tech.stoocker.app"                     â”‚           â”‚
â”‚   â”‚  â€¢ Subdomain wildcard DNS ile yÃ¶nlendirilir (*.stoocker.app)       â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Connection String Ãœretim Stratejisi

Tenant veritabanlarÄ± iÃ§in connection string Ã¼retimi `CreateTenantFromRegistrationCommandHandler.GenerateConnectionString()` metodunda yapÄ±lÄ±r:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                      â”‚
â”‚                   CONNECTION STRING ÃœRETÄ°M STRATEJÄ°SÄ°                               â”‚
â”‚                                                                                      â”‚
â”‚   Kaynak Kod: CreateTenantFromRegistrationCommandHandler.cs (SatÄ±r 626-647)        â”‚
â”‚                                                                                      â”‚
â”‚   Algoritma:                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  1. Master connection string'i al                                    â”‚           â”‚
â”‚   â”‚     â””â”€ var masterConnectionString =                                 â”‚           â”‚
â”‚   â”‚        _configuration.GetConnectionString("MasterConnection");      â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  2. Connection string'i parse et                                     â”‚           â”‚
â”‚   â”‚     â””â”€ var builder = new NpgsqlConnectionStringBuilder(master...);  â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  3. Sadece veritabanÄ± adÄ±nÄ± deÄŸiÅŸtir                                â”‚           â”‚
â”‚   â”‚     â””â”€ builder.Database = databaseName;                             â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  4. Yeni connection string'i dÃ¶ndÃ¼r                                  â”‚           â”‚
â”‚   â”‚     â””â”€ return builder.ConnectionString;                             â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   VeritabanÄ± AdÄ± FormatÄ±:                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  var databaseName = $"Stocker_{registration.CompanyCode               â”‚           â”‚
â”‚   â”‚                          .Replace("-", "_")}_Db";                    â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  Ã–rnekler:                                                           â”‚           â”‚
â”‚   â”‚  â€¢ CompanyCode: "abc-tech" â†’ Database: "Stocker_abc_tech_Db"       â”‚           â”‚
â”‚   â”‚  â€¢ CompanyCode: "demo123"  â†’ Database: "Stocker_demo123_Db"        â”‚           â”‚
â”‚   â”‚  â€¢ CompanyCode: "test"     â†’ Database: "Stocker_test_Db"           â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   GÃ¼venlik NotlarÄ±:                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  âš ï¸ MEVCUT DURUM:                                                   â”‚           â”‚
â”‚   â”‚  â€¢ TÃ¼m tenant veritabanlarÄ± AYNI PostgreSQL sunucusunda            â”‚           â”‚
â”‚   â”‚  â€¢ TÃ¼m tenant veritabanlarÄ± AYNI kullanÄ±cÄ±/ÅŸifre ile eriÅŸilir     â”‚           â”‚
â”‚   â”‚  â€¢ Connection string MasterDb ile aynÄ± server bilgilerini kullanÄ±r â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  ğŸ” Ã–NERÄ°LEN Ä°YÄ°LEÅTÄ°RMELER (Production iÃ§in):                     â”‚           â”‚
â”‚   â”‚  â€¢ Her tenant iÃ§in ayrÄ± PostgreSQL kullanÄ±cÄ±sÄ± oluÅŸturulabilir     â”‚           â”‚
â”‚   â”‚  â€¢ Connection string ÅŸifrelenmiÅŸ olarak saklanabilir               â”‚           â”‚
â”‚   â”‚  â€¢ Azure Key Vault / AWS Secrets Manager entegrasyonu              â”‚           â”‚
â”‚   â”‚  â€¢ Row-level security (RLS) ile ek gÃ¼venlik katmanÄ±               â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â”‚   Ã–rnek Connection String:                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  Master:                                                             â”‚           â”‚
â”‚   â”‚  Host=localhost;Database=StockerMaster;Username=postgres;           â”‚           â”‚
â”‚   â”‚  Password=xxx;Port=5432                                             â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â”‚  Tenant (abc-tech):                                                  â”‚           â”‚
â”‚   â”‚  Host=localhost;Database=Stocker_abc_tech_Db;Username=postgres;     â”‚           â”‚
â”‚   â”‚  Password=xxx;Port=5432                                             â”‚           â”‚
â”‚   â”‚                                                                      â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## VeritabanÄ± ÅemasÄ±

### Master Database

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MASTER DATABASE                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  TenantRegistrations                    Tenants                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Id (PK)                â”‚            â”‚ Id (PK)                â”‚                  â”‚
â”‚  â”‚ Email                  â”‚            â”‚ Name                   â”‚                  â”‚
â”‚  â”‚ CompanyName            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Code (subdomain)       â”‚                  â”‚
â”‚  â”‚ CompanyCode            â”‚            â”‚ Status                 â”‚                  â”‚
â”‚  â”‚ VerificationCode       â”‚            â”‚ IsActive               â”‚                  â”‚
â”‚  â”‚ Status                 â”‚            â”‚ SetupCompleted         â”‚                  â”‚
â”‚  â”‚ EmailVerified          â”‚            â”‚ SetupCompletedAt       â”‚                  â”‚
â”‚  â”‚ AdminPasswordHash      â”‚            â”‚ ConnectionString       â”‚                  â”‚
â”‚  â”‚ TenantId (FK)          â”‚            â”‚ DatabaseName           â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                   â”‚                                 â”‚
â”‚                                                   â”‚ 1:N                             â”‚
â”‚                                                   â–¼                                 â”‚
â”‚  Packages                              Subscriptions                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Id (PK)                â”‚            â”‚ Id (PK)                â”‚                  â”‚
â”‚  â”‚ Name                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ TenantId (FK)          â”‚                  â”‚
â”‚  â”‚ Type                   â”‚            â”‚ PackageId (FK)         â”‚                  â”‚
â”‚  â”‚ Price                  â”‚            â”‚ Status                 â”‚                  â”‚
â”‚  â”‚ MaxUsers               â”‚            â”‚ StartDate              â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ CurrentPeriodEnd       â”‚                  â”‚
â”‚           â”‚                            â”‚ TrialEndDate           â”‚                  â”‚
â”‚           â”‚ 1:N                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚           â–¼                                       â”‚                                 â”‚
â”‚  PackageModules                                   â”‚ 1:N                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â–¼                                 â”‚
â”‚  â”‚ Id (PK)                â”‚            SubscriptionModules                         â”‚
â”‚  â”‚ PackageId (FK)         â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ ModuleCode             â”‚            â”‚ Id (PK)                â”‚                  â”‚
â”‚  â”‚ ModuleName             â”‚            â”‚ SubscriptionId (FK)    â”‚                  â”‚
â”‚  â”‚ IsIncluded             â”‚            â”‚ ModuleCode             â”‚                  â”‚
â”‚  â”‚ MaxEntities            â”‚            â”‚ ModuleName             â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ MaxEntities            â”‚                  â”‚
â”‚                                        â”‚ AddedAt                â”‚                  â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                                     â”‚
â”‚  MasterUsers                           TenantDomains                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Id (PK)                â”‚            â”‚ Id (PK)                â”‚                  â”‚
â”‚  â”‚ Email                  â”‚            â”‚ TenantId (FK)          â”‚                  â”‚
â”‚  â”‚ Username               â”‚            â”‚ DomainName (unique)    â”‚                  â”‚
â”‚  â”‚ PasswordHash           â”‚            â”‚ IsPrimary              â”‚                  â”‚
â”‚  â”‚ TenantId (FK)          â”‚            â”‚ IsVerified             â”‚                  â”‚
â”‚  â”‚ IsTenantAdmin          â”‚            â”‚ VerifiedAt             â”‚                  â”‚
â”‚  â”‚ IsEmailVerified        â”‚            â”‚ CreatedAt              â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                                     â”‚
â”‚  ModuleDefinitions                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ Id (PK)                â”‚                                                        â”‚
â”‚  â”‚ Code (unique)          â”‚                                                        â”‚
â”‚  â”‚ Name                   â”‚                                                        â”‚
â”‚  â”‚ Description            â”‚                                                        â”‚
â”‚  â”‚ DbContextName          â”‚                                                        â”‚
â”‚  â”‚ IsCore                 â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tenant Database (Her tenant iÃ§in ayrÄ±)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TENANT DATABASE (Stocker_{code}_Db)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  Core Schema (tenant)                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚ TenantUsers            â”‚                                                        â”‚
â”‚  â”‚ Companies              â”‚                                                        â”‚
â”‚  â”‚ Branches               â”‚                                                        â”‚
â”‚  â”‚ Departments            â”‚                                                        â”‚
â”‚  â”‚ AuditLogs              â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                                     â”‚
â”‚  Module Schemas (ModÃ¼l seÃ§imine gÃ¶re oluÅŸturulur)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ crm.*                  â”‚  â”‚ sales.*                â”‚  â”‚ inventory.*            â”‚â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚â”‚
â”‚  â”‚ Customers              â”‚  â”‚ SalesOrders            â”‚  â”‚ Products               â”‚â”‚
â”‚  â”‚ Contacts               â”‚  â”‚ Quotations             â”‚  â”‚ Warehouses             â”‚â”‚
â”‚  â”‚ Leads                  â”‚  â”‚ Invoices               â”‚  â”‚ StockMovements         â”‚â”‚
â”‚  â”‚ Opportunities          â”‚  â”‚ Payments               â”‚  â”‚ Transfers              â”‚â”‚
â”‚  â”‚ Pipelines              â”‚  â”‚ Shipments              â”‚  â”‚ Categories             â”‚â”‚
â”‚  â”‚ Campaigns              â”‚  â”‚ ...                    â”‚  â”‚ ...                    â”‚â”‚
â”‚  â”‚ Accounts               â”‚  â”‚                        â”‚  â”‚                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ hr.*                   â”‚  â”‚ finance.*              â”‚                           â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚                           â”‚
â”‚  â”‚ Employees              â”‚  â”‚ Accounts               â”‚                           â”‚
â”‚  â”‚ LeaveRequests          â”‚  â”‚ JournalEntries         â”‚                           â”‚
â”‚  â”‚ Departments            â”‚  â”‚ AccountingPeriods      â”‚                           â”‚
â”‚  â”‚ Positions              â”‚  â”‚ Budgets                â”‚                           â”‚
â”‚  â”‚ Payroll                â”‚  â”‚ ...                    â”‚                           â”‚
â”‚  â”‚ ...                    â”‚  â”‚                        â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ã–nemli Dosyalar

### Backend

| Dosya | AÃ§Ä±klama |
|-------|----------|
| `RegisterTenantCommand.cs` | KayÄ±t formunu tanÄ±mlar (PackageId dahil ama kullanÄ±lmÄ±yor) |
| `RegisterTenantCommandHandler.cs` | KayÄ±t formunu iÅŸler, doÄŸrulama kodu gÃ¶nderir |
| `VerifyEmailCommandHandler.cs` | E-posta doÄŸrulamasÄ± + **SENKRON migration** + TenantDomain oluÅŸturma |
| `CreateTenantFromRegistrationCommandHandler.cs` | Tenant oluÅŸturma + **orphaned tenant temizliÄŸi** |
| `CompleteSetupCommandHandler.cs` | Paket seÃ§imi sonrasÄ± subscription ve modÃ¼lleri oluÅŸturur |
| `MigrationService.cs` | ModÃ¼l migration'larÄ±nÄ± Ã§alÄ±ÅŸtÄ±rÄ±r |
| `UserModulesController.cs` | Aktif modÃ¼lleri frontend'e dÃ¶ner (SubscriptionModules Ã¶ncelikli) |
| `TenantCreationProgressService.cs` | SignalR ile ilerleme bildirimi |

### Frontend

| Dosya | AÃ§Ä±klama |
|-------|----------|
| `TenantCreationProgress.tsx` | Tenant oluÅŸturma ilerleme sayfasÄ± (animated checkmarks) |
| `setup-wizard/page.tsx` | Setup wizard ana sayfasÄ± |
| `useUserModules.ts` | ModÃ¼l bilgilerini Ã§eken React Query hook |
| `user-modules.service.ts` | ModÃ¼l API servisi |

---

## SignalR OlaylarÄ±

```typescript
// Hub: TenantCreationHub
// Group: registration_{registrationId}

// Events:
interface TenantCreationProgress {
  registrationId: Guid;
  step: TenantCreationStep;
  message: string;
  progressPercentage: number;
  isCompleted: boolean;
  hasError: boolean;
  errorMessage?: string;
}

enum TenantCreationStep {
  EmailVerified = 0,
  Starting = 1,
  CreatingTenant = 2,
  CreatingMasterUser = 4,
  CreatingDatabase = 5,
  RunningMigrations = 6,
  SeedingData = 7,
  ActivatingTenant = 9,
  SendingWelcomeEmail = 10,
  Completed = 11,
  Failed = 12
}
```

---

## ModÃ¼l KodlarÄ±

| Kod | ModÃ¼l AdÄ± | DbContext |
|-----|-----------|-----------|
| `CRM` | MÃ¼ÅŸteri Ä°liÅŸkileri | CRMDbContext |
| `Sales` | SatÄ±ÅŸ | SalesDbContext |
| `Inventory` | Stok YÃ¶netimi | InventoryDbContext |
| `HR` | Ä°nsan KaynaklarÄ± | HRDbContext |
| `Finance` | Finans/Muhasebe | FinanceDbContext |
| `Purchase` | SatÄ±n Alma | PurchaseDbContext |
| `Projects` | Proje YÃ¶netimi | ProjectsDbContext |

---

## Hata SenaryolarÄ±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HATA SENARYOLARI                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. E-posta doÄŸrulama hatasÄ±                                    â”‚
â”‚     â†’ KullanÄ±cÄ±ya hata mesajÄ± gÃ¶ster                           â”‚
â”‚     â†’ Yeni kod gÃ¶nderme seÃ§eneÄŸi sun                           â”‚
â”‚                                                                 â”‚
â”‚  2. E-posta doÄŸrulama sÄ±rasÄ±nda migration hatasÄ±               â”‚
â”‚     â†’ Error: "VerifyEmail.DatabaseCreationFailed"              â”‚
â”‚     â†’ Mesaj: "Email doÄŸrulandÄ± ancak sistem hazÄ±rlanÄ±rken      â”‚
â”‚              bir hata oluÅŸtu. LÃ¼tfen birkaÃ§ dakika sonra       â”‚
â”‚              tekrar deneyin."                                   â”‚
â”‚     â†’ Email doÄŸrulanmÄ±ÅŸ durumda kalÄ±r                          â”‚
â”‚                                                                 â”‚
â”‚  3. Tenant oluÅŸturma hatasÄ± (SignalR akÄ±ÅŸÄ±nda)                 â”‚
â”‚     â†’ SignalR ile Failed step gÃ¶nder                           â”‚
â”‚     â†’ TenantRegistration.Status = Failed                       â”‚
â”‚     â†’ KullanÄ±cÄ±ya "Tekrar Dene" butonu gÃ¶ster                  â”‚
â”‚     â†’ Sonraki denemede orphaned tenant temizliÄŸi yapÄ±lÄ±r       â”‚
â”‚                                                                 â”‚
â”‚  4. Orphaned tenant temizlik hatasÄ±                             â”‚
â”‚     â†’ Error: "Tenant.CleanupFailed"                            â”‚
â”‚     â†’ Mesaj: "Ã–nceki baÅŸarÄ±sÄ±z tenant oluÅŸturma iÅŸlemi         â”‚
â”‚              temizlenemedi. LÃ¼tfen destek ile iletiÅŸime geÃ§in."â”‚
â”‚     â†’ Manuel mÃ¼dahale gerekir                                   â”‚
â”‚                                                                 â”‚
â”‚  5. Migration hatasÄ± (Setup Wizard'da)                          â”‚
â”‚     â†’ Log'a detaylÄ± hata yaz                                   â”‚
â”‚     â†’ Subscription rollback yap                                â”‚
â”‚     â†’ KullanÄ±cÄ±ya bilgi ver                                    â”‚
â”‚                                                                 â”‚
â”‚  6. Subscription bulunamadÄ±                                     â”‚
â”‚     â†’ UserModulesController boÅŸ modÃ¼l listesi dÃ¶ner            â”‚
â”‚     â†’ Frontend sidebar'da hiÃ§ modÃ¼l gÃ¶stermez                  â”‚
â”‚     â†’ Setup Wizard'a yÃ¶nlendir                                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ä°yileÅŸtirme Ã–nerileri

### 1. PackageId Konusunda
```
MEVCUT DURUM:
- RegisterTenantCommand.cs iÃ§inde PackageId zorunlu alan olarak tanÄ±mlÄ±
- CreateTenantFromRegistrationCommandHandler bu deÄŸeri kullanmÄ±yor
- Subscription oluÅŸturma CompleteSetup'a bÄ±rakÄ±lmÄ±ÅŸ

Ã–NERÄ°LER:
A) PackageId'yi RegisterTenantCommand'dan kaldÄ±r (opsiyonel yap)
   â†’ KullanÄ±cÄ± kayÄ±t sÄ±rasÄ±nda paket seÃ§mek zorunda kalmaz
   â†’ Setup Wizard'da Ã¶zgÃ¼rce seÃ§im yapabilir

B) Veya kayÄ±t sÄ±rasÄ±nda Trial subscription oluÅŸtur
   â†’ PackageId'yi kullan, Trial paket ile baÅŸlat
   â†’ Setup Wizard'da upgrade seÃ§eneÄŸi sun
```

### 2. Migration ZamanlamasÄ± Konusunda
```
MEVCUT DURUM:
- VerifyEmailCommandHandler SENKRON migration Ã§alÄ±ÅŸtÄ±rÄ±yor (satÄ±r 198)
- CreateTenantFromRegistration TEKRAR migration Ã§alÄ±ÅŸtÄ±rÄ±yor
- Bu durum bazÄ± edge case'lerde sorun yaratabilir

Ã–NERÄ°LER:
A) VerifyEmail'den migration'Ä± kaldÄ±r
   â†’ Sadece email doÄŸrulama + TenantDomain oluÅŸturma yapsÄ±n
   â†’ Migration'lar CreateTenantFromRegistration'da yapÄ±lsÄ±n (SignalR ile takip)

B) Veya CreateTenantFromRegistration'dan migration'Ä± kaldÄ±r
   â†’ Migration zaten VerifyEmail'de yapÄ±ldÄ±ysa atlansÄ±n
   â†’ Idempotent migration kontrolÃ¼ ekle
```

### 3. Connection String GÃ¼venliÄŸi
```
Ã–NERÄ°LER:
- Her tenant iÃ§in ayrÄ± PostgreSQL kullanÄ±cÄ±sÄ±
- Connection string'leri ÅŸifrelenmiÅŸ sakla (Azure Key Vault, AWS Secrets Manager)
- Row-Level Security (RLS) ile ek gÃ¼venlik katmanÄ±
- Audit logging iÃ§in connection bilgilerini loglamadan sakla
```
