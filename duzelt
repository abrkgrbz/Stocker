labels:
  - "traefik.enable=true"
  - "traefik.docker.network=coolify"
  
  # API routing - PRIORITY EKLENDİ
  - "traefik.http.routers.api-secure.rule=Host(`api.stoocker.app`)"
  - "traefik.http.routers.api-secure.entrypoints=https"
  - "traefik.http.routers.api-secure.tls=true"
  - "traefik.http.routers.api-secure.tls.certresolver=letsencrypt"
  - "traefik.http.routers.api-secure.service=api-service"
  - "traefik.http.routers.api-secure.priority=90"  # YÜKSEK ÖNCELİK
  - "traefik.http.services.api-service.loadbalancer.server.port=5000"

  labels:
  - "traefik.enable=true"
  - "traefik.docker.network=coolify"
  
  # Ana domain için router
  - "traefik.http.routers.stocker-web-main.rule=Host(`stoocker.app`) || Host(`www.stoocker.app`)"
  - "traefik.http.routers.stocker-web-main.entrypoints=https"
  - "traefik.http.routers.stocker-web-main.tls=true"
  - "traefik.http.routers.stocker-web-main.tls.certresolver=letsencrypt"  # TUTARLI CERTRESOLVER
  - "traefik.http.routers.stocker-web-main.service=stocker-web-service"
  - "traefik.http.routers.stocker-web-main.priority=50"  # ORTA ÖNCELİK
  - "traefik.http.routers.stocker-web-main.middlewares=www-redirect"
  
  # Wildcard subdomain router - DÜZELTİLMİŞ REGEX
  - "traefik.http.routers.stocker-web-wildcard.rule=HostRegexp(`{subdomain:[a-z0-9][a-z0-9-]*}.stoocker.app`)"
  - "traefik.http.routers.stocker-web-wildcard.entrypoints=https"
  - "traefik.http.routers.stocker-web-wildcard.tls=true"
  - "traefik.http.routers.stocker-web-wildcard.tls.certresolver=letsencrypt"
  - "traefik.http.routers.stocker-web-wildcard.service=stocker-web-service"
  - "traefik.http.routers.stocker-web-wildcard.priority=1"  # EN DÜŞÜK ÖNCELİK
  
  # HTTP -> HTTPS yönlendirmeleri
  - "traefik.http.routers.stocker-web-main-http.rule=Host(`stoocker.app`) || Host(`www.stoocker.app`)"
  - "traefik.http.routers.stocker-web-main-http.entrypoints=http"
  - "traefik.http.routers.stocker-web-main-http.middlewares=redirect-https"
  
  - "traefik.http.routers.stocker-web-wildcard-http.rule=HostRegexp(`{subdomain:[a-z0-9][a-z0-9-]*}.stoocker.app`)"
  - "traefik.http.routers.stocker-web-wildcard-http.entrypoints=http"
  - "traefik.http.routers.stocker-web-wildcard-http.middlewares=redirect-https"
  
  # Service tanımı
  - "traefik.http.services.stocker-web-service.loadbalancer.server.port=80"
  
  # Middleware tanımları
  - "traefik.http.middlewares.redirect-https.redirectscheme.scheme=https"
  - "traefik.http.middlewares.redirect-https.redirectscheme.permanent=true"
  
  - "traefik.http.middlewares.www-redirect.redirectregex.regex=^https://www\\.(.*)$"
  - "traefik.http.middlewares.www-redirect.redirectregex.replacement=https://$${1}"
  - "traefik.http.middlewares.www-redirect.redirectregex.permanent=true"

  labels:
  - "traefik.enable=true"
  - "traefik.docker.network=coolify"
  
  # Admin routing - PRIORITY EKLENDİ
  - "traefik.http.routers.admin-secure.rule=Host(`admin.stoocker.app`)"
  - "traefik.http.routers.admin-secure.entrypoints=https"
  - "traefik.http.routers.admin-secure.tls=true"
  - "traefik.http.routers.admin-secure.tls.certresolver=letsencrypt"
  - "traefik.http.routers.admin-secure.service=admin-service"  # Service adı düzeltildi
  - "traefik.http.routers.admin-secure.priority=85"  # YÜKSEK ÖNCELİK
  - "traefik.http.services.admin-service.loadbalancer.server.port=80"